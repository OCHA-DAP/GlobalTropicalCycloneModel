# Mean International Wealth Index

- For Vietnam `https://globaldatalab.org/areadata/table/iwi/`


```python
import pandas as pd
import geopandas as gpd
from pathlib import Path
import matplotlib.pyplot as plt
import os
import ast
```


```python
base_dir = Path(os.getenv("STORM_DATA_DIR")) / "analysis_vnm/02_model_features/"
input_dir = base_dir / "05_vulnerability/input/"
shp_input_dir = base_dir / "02_housing_damage/output/"
output_dir = base_dir / "05_vulnerability/output/"

# Load ids of municipalities
ids_mun = pd.read_csv(base_dir / "02_housing_damage/input/grid_municipality_info.csv")

# Load grids
grid = gpd.read_file(base_dir / "02_housing_damage/output/viet_0.1_degree_grid_land_overlap_new.gpkg")

# Load IWI
iwi = pd.read_csv(input_dir / "GDL-Mean-International-Wealth-Index-(IWI)-score-of-region-data.csv")

# Load Shapefile
viet = gpd.read_file(base_dir / "02_housing_damage/input/adm2_shp_fixed.gpkg")
viet = viet.to_crs('EPSG:4326')
```


```python
country = 'Vietnam'
iwi_country = iwi[(iwi.Country == country) & (iwi.Level == 'Subnat')]
iwi_country
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Continent</th>
      <th>ISO_Code</th>
      <th>Level</th>
      <th>GDLCODE</th>
      <th>Region</th>
      <th>1992</th>
      <th>1993</th>
      <th>1994</th>
      <th>1995</th>
      <th>...</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1544</th>
      <td>Vietnam</td>
      <td>Asia/Pacific</td>
      <td>VNM</td>
      <td>Subnat</td>
      <td>VNMr104</td>
      <td>Central Highlands</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>30.0</td>
      <td>31.4</td>
      <td>...</td>
      <td>67.8</td>
      <td>68.1</td>
      <td>68.9</td>
      <td>69.6</td>
      <td>70.4</td>
      <td>71.1</td>
      <td>71.9</td>
      <td>72.6</td>
      <td>73.4</td>
      <td>74.1</td>
    </tr>
    <tr>
      <th>1545</th>
      <td>Vietnam</td>
      <td>Asia/Pacific</td>
      <td>VNM</td>
      <td>Subnat</td>
      <td>VNMr106</td>
      <td>Mekong River Delta</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.7</td>
      <td>24.7</td>
      <td>...</td>
      <td>67.8</td>
      <td>68.9</td>
      <td>70.4</td>
      <td>71.8</td>
      <td>73.3</td>
      <td>74.7</td>
      <td>76.2</td>
      <td>77.6</td>
      <td>79.1</td>
      <td>80.5</td>
    </tr>
    <tr>
      <th>1546</th>
      <td>Vietnam</td>
      <td>Asia/Pacific</td>
      <td>VNM</td>
      <td>Subnat</td>
      <td>VNMr103</td>
      <td>North Central Coast and South Central Coast</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>26.6</td>
      <td>28.8</td>
      <td>...</td>
      <td>70.3</td>
      <td>71.5</td>
      <td>72.6</td>
      <td>73.8</td>
      <td>75.0</td>
      <td>76.2</td>
      <td>77.4</td>
      <td>78.6</td>
      <td>79.8</td>
      <td>80.9</td>
    </tr>
    <tr>
      <th>1547</th>
      <td>Vietnam</td>
      <td>Asia/Pacific</td>
      <td>VNM</td>
      <td>Subnat</td>
      <td>VNMr102</td>
      <td>North East, North West</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>24.2</td>
      <td>26.0</td>
      <td>...</td>
      <td>65.4</td>
      <td>66.4</td>
      <td>67.3</td>
      <td>68.3</td>
      <td>69.3</td>
      <td>70.3</td>
      <td>71.3</td>
      <td>72.3</td>
      <td>73.3</td>
      <td>74.2</td>
    </tr>
    <tr>
      <th>1548</th>
      <td>Vietnam</td>
      <td>Asia/Pacific</td>
      <td>VNM</td>
      <td>Subnat</td>
      <td>VNMr101</td>
      <td>Red River Delta</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>33.5</td>
      <td>36.0</td>
      <td>...</td>
      <td>78.1</td>
      <td>79.4</td>
      <td>80.2</td>
      <td>81.0</td>
      <td>81.7</td>
      <td>82.5</td>
      <td>83.3</td>
      <td>84.0</td>
      <td>84.8</td>
      <td>85.6</td>
    </tr>
    <tr>
      <th>1549</th>
      <td>Vietnam</td>
      <td>Asia/Pacific</td>
      <td>VNM</td>
      <td>Subnat</td>
      <td>VNMr105</td>
      <td>South East</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>48.2</td>
      <td>50.0</td>
      <td>...</td>
      <td>82.1</td>
      <td>82.6</td>
      <td>82.8</td>
      <td>83.0</td>
      <td>83.2</td>
      <td>83.4</td>
      <td>83.6</td>
      <td>83.8</td>
      <td>84.0</td>
      <td>84.2</td>
    </tr>
  </tbody>
</table>
<p>6 rows Ã— 37 columns</p>
</div>



### Do I need to distinguish between the year?


```python
y2013 = iwi_country['2013']
y2015 = iwi_country['2015']
y2017 = iwi_country['2017']
y2019 = iwi_country['2019']
y2022 = iwi_country['2022']
fig, ax = plt.subplots(2,2)
ax = ax.flatten()

ax[0].plot(y2013,y2015, 'o')
ax[0].set_xlabel('IWI 2013')
ax[0].set_ylabel('IWI 2015')
ax[1].plot(y2015,y2017, 'o')
ax[1].set_xlabel('IWI 2015')
ax[1].set_ylabel('IWI 2017')
ax[2].plot(y2017,y2019, 'o')
ax[2].set_xlabel('IWI 2017')
ax[2].set_ylabel('IWI 2019')
ax[3].plot(y2019,y2022, 'o')
ax[3].set_xlabel('IWI 2019')
ax[3].set_ylabel('IWI 2012')

plt.tight_layout()
plt.show()
```



![png](05.0_international_wealth_index_files/05.0_international_wealth_index_6_0.png)



Nop. Its the same, they are all correlated. Lets work with the IWI 2022 since its the last one

### Municipality to grid cell

Keep in mind that I'm not distributing the IWI across each grid cell, because its a fix value for the Province. So, each grid cell of a municipality has the same value as the municipality.


```python
ids_mun.region.unique()
```




    array(['MD', 'SE', 'NE', 'RRD', 'SC', 'C', 'NW', 'NC'], dtype=object)




```python
# Manual labeling
regions = ['C', 'MD', "['NC', 'SC']", "['NE', 'NW']", 'RRD', 'SE']
iwi_country['region'] = regions
```

    /var/folders/dy/vms3cfrn4q9952h8s6l586dr0000gp/T/ipykernel_60530/1889435250.py:3: SettingWithCopyWarning:
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead

    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      iwi_country['region'] = regions



```python
# To list
def str_to_list(x):
    try:
        y = ast.literal_eval(x)
    except:
        y = x
    return y

iwi_country['region'] = iwi_country['region'].apply(lambda x: str_to_list(x))
iwi_country_fixed = iwi_country[
    ['region', '2022']
    ].explode('region').reset_index(drop=True)

# Merge with Municipality
df_mun_iwi = iwi_country_fixed.merge(ids_mun, on='region').drop_duplicates(
    subset=['id', '2022', 'region']
    )

# Merge with Shapefile
IWI_viet = df_mun_iwi.merge(viet, on='region', how='left').drop_duplicates(subset=['id', '2022', 'region'])[
    ['id', '2022']
    ].reset_index(drop=True).rename({
        'id':'grid_point_id',
        '2022':'IWI'}, axis=1)
```

    /var/folders/dy/vms3cfrn4q9952h8s6l586dr0000gp/T/ipykernel_60530/2358884682.py:9: SettingWithCopyWarning:
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead

    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      iwi_country['region'] = iwi_country['region'].apply(lambda x: str_to_list(x))


### Save it


```python
IWI_viet[['grid_point_id', 'IWI']].to_csv(output_dir / "viet_iwi_bygrid_new.csv", index=False)
```

### Some plots


```python
geo_IWI = gpd.GeoDataFrame(IWI_viet.merge(grid, left_on='grid_point_id', right_on='id'), geometry='geometry')
```


```python
fig, ax = plt.subplots(1, 1, figsize=(6, 6))

# Plot
geo_IWI.plot(column='IWI', cmap='viridis', linewidth=0.8, ax=ax, legend=True)

ax.set_title('ADM1 Municipality Coloring by IWI')
ax.set_xlabel('Longitude')
ax.set_ylabel('Latitude')
# Show the plot
plt.show()
```



![png](05.0_international_wealth_index_files/05.0_international_wealth_index_17_0.png)
