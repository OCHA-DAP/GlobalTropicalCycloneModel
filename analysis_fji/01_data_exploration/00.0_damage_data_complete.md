```python
import pandas as pd
import os
from pathlib import Path
```


```python
pd.set_option("display.float_format", lambda x: "%.5f" % x)
input_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_new_model_input/02_housing_damage/input/"
)
baseline_input_dir = (
    Path(os.getenv("STORM_DATA_DIR")) / "analysis_fji/01_baseline_model/input/"
)
output_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_new_model_input/02_housing_damage/output/"
)
```

### Load data


```python
# Load housing damage
df_housing = pd.read_csv(input_dir / "fji_impact_data/processed_house_impact_new.csv")

# Define total damage
df_housing['total'] = df_housing['Destroyed'] + df_housing['Major Damage']
df_housing['total'] = df_housing['total'].astype(int)
df_housing['Year'] = df_housing['Year'].astype('Int64')

# Be concise
build_dmg_data = df_housing[['ADM1_NAME', 'ADM2_NAME', 'Cyclone Name', 'Year', 'Destroyed', 'Major Damage', 'total']].rename({'Cyclone Name':'typhoon', 'Destroyed':'Totally', 'Major Damage':'Partially' }, axis=1)

```


```python
build_dmg_data.isna().sum()
```




    ADM1_NAME     0
    ADM2_NAME    12
    typhoon       0
    Year          5
    Totally       0
    Partially     0
    total         0
    dtype: int64




```python
build_dmg_data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ADM1_NAME</th>
      <th>ADM2_NAME</th>
      <th>typhoon</th>
      <th>Year</th>
      <th>Totally</th>
      <th>Partially</th>
      <th>total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Central Division</td>
      <td>Naitasiri</td>
      <td>Winston</td>
      <td>2016</td>
      <td>542.00000</td>
      <td>365.00000</td>
      <td>907</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Central Division</td>
      <td>Namosi</td>
      <td>Winston</td>
      <td>2016</td>
      <td>27.00000</td>
      <td>14.00000</td>
      <td>41</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Central Division</td>
      <td>Rewa</td>
      <td>Winston</td>
      <td>2016</td>
      <td>66.00000</td>
      <td>78.00000</td>
      <td>144</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Central Division</td>
      <td>Serua</td>
      <td>Winston</td>
      <td>2016</td>
      <td>19.00000</td>
      <td>19.00000</td>
      <td>38</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Central Division</td>
      <td>Tailevu</td>
      <td>Winston</td>
      <td>2016</td>
      <td>395.00000</td>
      <td>287.00000</td>
      <td>682</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Northern Division</td>
      <td>Cakaudrove</td>
      <td>Winston</td>
      <td>2016</td>
      <td>1513.00000</td>
      <td>2199.00000</td>
      <td>3712</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Northern Division</td>
      <td>Bua</td>
      <td>Winston</td>
      <td>2016</td>
      <td>524.00000</td>
      <td>605.00000</td>
      <td>1129</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Northern Division</td>
      <td>Macuata</td>
      <td>Winston</td>
      <td>2016</td>
      <td>5.00000</td>
      <td>10.00000</td>
      <td>15</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Western Division</td>
      <td>Nadroga_Navosa</td>
      <td>Winston</td>
      <td>2016</td>
      <td>113.00000</td>
      <td>259.00000</td>
      <td>372</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Western Division</td>
      <td>Ba</td>
      <td>Winston</td>
      <td>2016</td>
      <td>3494.00000</td>
      <td>4241.00000</td>
      <td>7735</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Western Division</td>
      <td>Ra</td>
      <td>Winston</td>
      <td>2016</td>
      <td>2813.00000</td>
      <td>757.00000</td>
      <td>3570</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Eastern Division</td>
      <td>Lau</td>
      <td>Winston</td>
      <td>2016</td>
      <td>328.00000</td>
      <td>63.00000</td>
      <td>391</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Eastern Division</td>
      <td>Kadavu</td>
      <td>Winston</td>
      <td>2016</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Eastern Division</td>
      <td>Lomaiviti</td>
      <td>Winston</td>
      <td>2016</td>
      <td>1191.00000</td>
      <td>296.00000</td>
      <td>1487</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Northern Division</td>
      <td>NaN</td>
      <td>Sarai</td>
      <td>2019</td>
      <td>1.00000</td>
      <td>3.00000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Western Division</td>
      <td>NaN</td>
      <td>Sarai</td>
      <td>2019</td>
      <td>8.00000</td>
      <td>26.00000</td>
      <td>34</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Central Division</td>
      <td>NaN</td>
      <td>Sarai</td>
      <td>2019</td>
      <td>1.00000</td>
      <td>16.00000</td>
      <td>17</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Eastern Division</td>
      <td>NaN</td>
      <td>Sarai</td>
      <td>2019</td>
      <td>14.00000</td>
      <td>12.00000</td>
      <td>26</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Northern Division</td>
      <td>NaN</td>
      <td>Tino</td>
      <td>2019</td>
      <td>2.00000</td>
      <td>6.00000</td>
      <td>8</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Western Division</td>
      <td>NaN</td>
      <td>Tino</td>
      <td>2019</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Central Division</td>
      <td>NaN</td>
      <td>Tino</td>
      <td>2019</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Eastern Division</td>
      <td>NaN</td>
      <td>Tino</td>
      <td>2019</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Central Division</td>
      <td>Naitasiri</td>
      <td>Harold</td>
      <td>2020</td>
      <td>14.00000</td>
      <td>109.00000</td>
      <td>123</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Central Division</td>
      <td>Namosi</td>
      <td>Harold</td>
      <td>2020</td>
      <td>17.00000</td>
      <td>38.00000</td>
      <td>55</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Central Division</td>
      <td>Rewa</td>
      <td>Harold</td>
      <td>2020</td>
      <td>8.00000</td>
      <td>33.00000</td>
      <td>41</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Central Division</td>
      <td>Serua</td>
      <td>Harold</td>
      <td>2020</td>
      <td>8.00000</td>
      <td>63.00000</td>
      <td>71</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Central Division</td>
      <td>Tailevu</td>
      <td>Harold</td>
      <td>2020</td>
      <td>58.00000</td>
      <td>255.00000</td>
      <td>313</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Northern Division</td>
      <td>Cakaudrove</td>
      <td>Harold</td>
      <td>2020</td>
      <td>2.00000</td>
      <td>5.00000</td>
      <td>7</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Western Division</td>
      <td>Nadroga_Navosa</td>
      <td>Harold</td>
      <td>2020</td>
      <td>125.00000</td>
      <td>394.00000</td>
      <td>519</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Western Division</td>
      <td>Ba</td>
      <td>Harold</td>
      <td>2020</td>
      <td>33.00000</td>
      <td>162.00000</td>
      <td>195</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Western Division</td>
      <td>Ra</td>
      <td>Harold</td>
      <td>2020</td>
      <td>0.00000</td>
      <td>50.00000</td>
      <td>50</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Eastern Division</td>
      <td>Lau</td>
      <td>Harold</td>
      <td>2020</td>
      <td>108.00000</td>
      <td>77.00000</td>
      <td>185</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Eastern Division</td>
      <td>Kadavu</td>
      <td>Harold</td>
      <td>2020</td>
      <td>572.00000</td>
      <td>1006.00000</td>
      <td>1578</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Eastern Division</td>
      <td>Lomaiviti</td>
      <td>Harold</td>
      <td>2020</td>
      <td>1.00000</td>
      <td>3.00000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Northern Division</td>
      <td>Bua</td>
      <td>Yasa</td>
      <td>2020</td>
      <td>513.00000</td>
      <td>1034.00000</td>
      <td>1547</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Northern Division</td>
      <td>Macuata</td>
      <td>Yasa</td>
      <td>2020</td>
      <td>565.00000</td>
      <td>3456.00000</td>
      <td>4021</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Northern Division</td>
      <td>Cakaudrove</td>
      <td>Yasa</td>
      <td>2020</td>
      <td>455.00000</td>
      <td>1594.00000</td>
      <td>2049</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Western Division</td>
      <td>Ba</td>
      <td>Yasa</td>
      <td>2020</td>
      <td>6.00000</td>
      <td>41.00000</td>
      <td>47</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Western Division</td>
      <td>Ra</td>
      <td>Yasa</td>
      <td>2020</td>
      <td>2.00000</td>
      <td>23.00000</td>
      <td>25</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Central Division</td>
      <td>Tailevu</td>
      <td>Yasa</td>
      <td>2020</td>
      <td>0.00000</td>
      <td>4.00000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Central Division</td>
      <td>Naitasiri</td>
      <td>Ana</td>
      <td>2021</td>
      <td>3.00000</td>
      <td>116.00000</td>
      <td>119</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Central Division</td>
      <td>Namosi</td>
      <td>Ana</td>
      <td>2021</td>
      <td>4.00000</td>
      <td>36.00000</td>
      <td>40</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Central Division</td>
      <td>Rewa</td>
      <td>Ana</td>
      <td>2021</td>
      <td>7.00000</td>
      <td>56.00000</td>
      <td>63</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Central Division</td>
      <td>Serua</td>
      <td>Ana</td>
      <td>2021</td>
      <td>9.00000</td>
      <td>54.00000</td>
      <td>63</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Central Division</td>
      <td>Tailevu</td>
      <td>Ana</td>
      <td>2021</td>
      <td>2.00000</td>
      <td>11.00000</td>
      <td>13</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Northern Division</td>
      <td>Cakaudrove</td>
      <td>Ana</td>
      <td>2021</td>
      <td>4.00000</td>
      <td>72.00000</td>
      <td>76</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Northern Division</td>
      <td>Bua</td>
      <td>Ana</td>
      <td>2021</td>
      <td>7.00000</td>
      <td>55.00000</td>
      <td>62</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Northern Division</td>
      <td>Macuata</td>
      <td>Ana</td>
      <td>2021</td>
      <td>20.00000</td>
      <td>321.00000</td>
      <td>341</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Western Division</td>
      <td>Nadroga_Navosa</td>
      <td>Ana</td>
      <td>2021</td>
      <td>1.00000</td>
      <td>10.00000</td>
      <td>11</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Western Division</td>
      <td>Ba</td>
      <td>Ana</td>
      <td>2021</td>
      <td>7.00000</td>
      <td>241.00000</td>
      <td>248</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Western Division</td>
      <td>Ra</td>
      <td>Ana</td>
      <td>2021</td>
      <td>7.00000</td>
      <td>42.00000</td>
      <td>49</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Eastern Division</td>
      <td>Lau</td>
      <td>Ana</td>
      <td>2021</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Eastern Division</td>
      <td>Kadavu</td>
      <td>Ana</td>
      <td>2021</td>
      <td>1.00000</td>
      <td>2.00000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Eastern Division</td>
      <td>Lomaiviti</td>
      <td>Ana</td>
      <td>2021</td>
      <td>0.00000</td>
      <td>11.00000</td>
      <td>11</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Western Division</td>
      <td>NaN</td>
      <td>Evan</td>
      <td>&lt;NA&gt;</td>
      <td>699.00000</td>
      <td>614.00000</td>
      <td>1313</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Northern Division</td>
      <td>NaN</td>
      <td>Evan</td>
      <td>&lt;NA&gt;</td>
      <td>124.00000</td>
      <td>118.00000</td>
      <td>242</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Eastern Division</td>
      <td>Lau</td>
      <td>Gita</td>
      <td>&lt;NA&gt;</td>
      <td>3.00000</td>
      <td>4.00000</td>
      <td>7</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Northern Division</td>
      <td>NaN</td>
      <td>Tomas</td>
      <td>&lt;NA&gt;</td>
      <td>97.00000</td>
      <td>0.00000</td>
      <td>97</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Eastern Division</td>
      <td>NaN</td>
      <td>Tomas</td>
      <td>&lt;NA&gt;</td>
      <td>47.00000</td>
      <td>174.00000</td>
      <td>221</td>
    </tr>
  </tbody>
</table>
</div>



### Fix it


```python
# Lets asign the year to evan, gina and tomas.
build_dmg_data.loc[build_dmg_data['typhoon'] == 'Evan', 'Year'] = build_dmg_data.loc[build_dmg_data['typhoon'] == 'Evan', 'Year'].fillna(2012)
build_dmg_data.loc[build_dmg_data['typhoon'] == 'Gita', 'Year'] = build_dmg_data.loc[build_dmg_data['typhoon'] == 'Gita', 'Year'].fillna(2018)
build_dmg_data.loc[build_dmg_data['typhoon'] == 'Tomas', 'Year'] = build_dmg_data.loc[build_dmg_data['typhoon'] == 'Tomas', 'Year'].fillna(2010)

```

Lets split the total damage values across all provinces in each division for the typhoons with no admin2 data


```python
# Define Municipalities in Provinces
east = ['Kadavu', 'Lau', 'Lomaiviti', 'Rotuma']
north =  ['Macuata', 'Cakaudrove', 'Bua']
west =  ['Ba', 'Nadroga_Navosa', 'Ra']
central = ['Naitasiri', 'Namosi', 'Rewa', 'Serua', 'Tailevu']

subset_damage = build_dmg_data[build_dmg_data.ADM2_NAME.isna()]

# Define the division-to-province mapping
division_to_province = {
    'Northern Division': north,
    'Western Division': west,
    'Central Division': central,
    'Eastern Division': east
}

# Create an empty DataFrame to store the expanded data
expanded_data = pd.DataFrame()

# Iterate through rows and expand divisions into multiple rows
for _, row in subset_damage.iterrows():
    division = row['ADM1_NAME']
    provinces = division_to_province.get(division, [])
    num_provinces = len(provinces)

    if num_provinces > 0:
        total_per_province = row['total'] / num_provinces
        for province in provinces:
            new_row = row.copy()
            new_row['ADM2_NAME'] = province
            new_row['total'] = total_per_province
            expanded_data = pd.concat([expanded_data, new_row.to_frame().T])

build_dmg_data = pd.concat([build_dmg_data.dropna(subset=['ADM2_NAME']), expanded_data]).copy()
```


```python
# Stadardize Municipality names
build_dmg_data = build_dmg_data.replace('Nadroga_Navosa','Nadroga/Navosa')
```

### Save it


```python
build_dmg_data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ADM1_NAME</th>
      <th>ADM2_NAME</th>
      <th>typhoon</th>
      <th>Year</th>
      <th>Totally</th>
      <th>Partially</th>
      <th>total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Central Division</td>
      <td>Naitasiri</td>
      <td>Winston</td>
      <td>2016</td>
      <td>542.00000</td>
      <td>365.00000</td>
      <td>907.00000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Central Division</td>
      <td>Namosi</td>
      <td>Winston</td>
      <td>2016</td>
      <td>27.00000</td>
      <td>14.00000</td>
      <td>41.00000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Central Division</td>
      <td>Rewa</td>
      <td>Winston</td>
      <td>2016</td>
      <td>66.00000</td>
      <td>78.00000</td>
      <td>144.00000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Central Division</td>
      <td>Serua</td>
      <td>Winston</td>
      <td>2016</td>
      <td>19.00000</td>
      <td>19.00000</td>
      <td>38.00000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Central Division</td>
      <td>Tailevu</td>
      <td>Winston</td>
      <td>2016</td>
      <td>395.00000</td>
      <td>287.00000</td>
      <td>682.00000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Northern Division</td>
      <td>Bua</td>
      <td>Tomas</td>
      <td>2010</td>
      <td>97.00000</td>
      <td>0.00000</td>
      <td>32.33333</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Eastern Division</td>
      <td>Kadavu</td>
      <td>Tomas</td>
      <td>2010</td>
      <td>47.00000</td>
      <td>174.00000</td>
      <td>55.25000</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Eastern Division</td>
      <td>Lau</td>
      <td>Tomas</td>
      <td>2010</td>
      <td>47.00000</td>
      <td>174.00000</td>
      <td>55.25000</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Eastern Division</td>
      <td>Lomaiviti</td>
      <td>Tomas</td>
      <td>2010</td>
      <td>47.00000</td>
      <td>174.00000</td>
      <td>55.25000</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Eastern Division</td>
      <td>Rotuma</td>
      <td>Tomas</td>
      <td>2010</td>
      <td>47.00000</td>
      <td>174.00000</td>
      <td>55.25000</td>
    </tr>
  </tbody>
</table>
<p>90 rows Ã— 7 columns</p>
</div>




```python
build_dmg_data.to_csv(input_dir / "fji_building_damage_mun_complete.csv")
```
