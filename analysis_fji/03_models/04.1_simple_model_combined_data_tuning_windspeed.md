```python
import matplotlib.pyplot as plt
import numpy as np

import pandas as pd

from utils import get_combined_dataset, xgb_model_combined_data_LOOCV
```


```python
# Load dataset
df_combined = get_combined_dataset()
df_fji = df_combined[df_combined.country == 'fji']

# Typhoons
fji_typhoons = df_fji.typhoon_name.unique()

# Features
features = [
    "wind_speed",
    "track_distance",
    "total_houses",
    "rainfall_max_6h",
    "rainfall_max_24h",
    "coast_length",
    "with_coast",
    "mean_elev",
    "mean_slope",
]
```


```python
# Stratification
dmg = np.array(df_fji.percent_houses_damaged.to_list())
zero_dmg = np.round((np.count_nonzero(dmg == 0) / len(dmg)) , 2 )

# Define ranges for each group
x0 = list(np.linspace(0, zero_dmg, 1))   # zero damage
x1 = list(np.linspace(zero_dmg, 0.93, 2))  # almost no damage
x2 = list(np.linspace(0.935, 1, 5))  # all the damage
x3=x0+x1+x2

bins = []
for i in x3:
    bins.append(np.quantile(dmg, i))

# Histogram after stratification
samples_per_bin_fji, bins_def_fji = np.histogram(dmg, bins=bins)

# Define number of bins
num_bins_fji = len(samples_per_bin_fji)

# For future plots
str_bin_fji = []
for i in range(len(bins_def_fji[:-1])):
    a = str(np.round(bins_def_fji[i+1],3))
    b = str(np.round(bins_def_fji[i],3))
    str_bin_fji.append('{} - {}'.format(b,a))
```

### Model including zero windspeed values


```python
# Run XGB
y_test_typhoon_fji, y_pred_typhoon_fji, rmse_strat_fji, avg_error_strat_fji = xgb_model_combined_data_LOOCV(
    df_combined=df_combined,
    df_fji=df_fji,
    bins=bins_def_fji,
    fji_weight=2,
    features=features
)
```

### Model dropping all zero windspeed values


```python
# Drop windspeed = 0
df_combined_drop = (df_combined[(df_combined[["wind_speed"]] != 0).any(axis=1)]).reset_index(drop=True)
df_fji_drop = df_combined_drop[df_combined_drop.country == 'fji']

# Run XGB
y_test_typhoon_fji_drop, y_pred_typhoon_fji_drop, rmse_strat_fji_drop, avg_error_strat_fji_drop = xgb_model_combined_data_LOOCV(
    df_combined=df_combined_drop,
    df_fji=df_fji_drop,
    bins=bins_def_fji,
    fji_weight=2,
    features=features
)
```

### Model dropping all zero windspeed values just on Philippines


```python
# Drop rows where 'wind_speed' is 0 in the 'phl' subset
df_combined_drop_phl = df_combined[df_combined.apply(lambda row: row['country'] == 'fji' or row['wind_speed'] != 0, axis=1)]

# Run XGB
y_test_typhoon_fji_drop_phl, y_pred_typhoon_fji_drop_phl, rmse_strat_fji_drop_phl, avg_error_strat_fji_drop_phl = xgb_model_combined_data_LOOCV(
    df_combined=df_combined_drop_phl,
    df_fji=df_fji_drop,
    bins=bins_def_fji,
    fji_weight=2,
    features=features
)
```

### Compare results


```python
fig, ax = plt.subplots(1,2, figsize=(10,6))

ax[0].plot(range(num_bins_fji), rmse_strat_fji, 'bs', label="Don't drop 0 windspeed values")
ax[0].plot(range(num_bins_fji), rmse_strat_fji_drop, 'rs', label="Drop all 0 windspeed values")
ax[0].plot(range(num_bins_fji), rmse_strat_fji_drop_phl, 'gs', label="Drop all 0 windspeed values on Phl subset")
ax[0].set_xticks(range(num_bins_fji), str_bin_fji, rotation=45)
ax[0].set_xlabel('Damage [%]')
ax[0].set_ylabel('RMSE')
ax[0].grid()
ax[0].legend()


ax[1].plot(range(num_bins_fji), avg_error_strat_fji, 'bs', label="Don't drop 0 windspeed values")
ax[1].plot(range(num_bins_fji), avg_error_strat_fji_drop, 'rs', label="Drop all 0 windspeed values")
ax[1].plot(range(num_bins_fji), avg_error_strat_fji_drop_phl, 'gs', label="Drop all 0 windspeed values on Phl subset")
ax[1].set_xticks(range(num_bins_fji), str_bin_fji, rotation=45)
ax[1].set_xlabel('Damage [%]')
ax[1].set_ylabel('Avg error ')
ax[1].grid()
ax[1].legend()

plt.suptitle('XGBoost Regression model trained on Philippines+Fiji \ndataset using LOOCV for Fiji typhoons')
plt.tight_layout()
plt.show()
```



![png](04.1_simple_model_combined_data_tuning_windspeed_files/04.1_simple_model_combined_data_tuning_windspeed_10_0.png)



Dropping 0 windspeed values on the Philippines subset is the correct approach.


```python
fig, ax = plt.subplots(1,1, figsize=(6,6))

ax.plot(range(num_bins_fji), rmse_strat_fji, 'bs', label="Don't drop 0 windspeed values")
ax.plot(range(num_bins_fji), rmse_strat_fji_drop, 'rs', label="Drop all 0 windspeed values")
ax.plot(range(num_bins_fji), rmse_strat_fji_drop_phl, 'gs', label="Drop all 0 windspeed values on Phl subset")
ax.set_xticks(range(num_bins_fji), str_bin_fji, rotation=45)
ax.set_xlabel('Damage [%]')
ax.set_ylabel('RMSE')
ax.grid()
ax.legend()


plt.suptitle('XGBoost Regression model trained on Philippines+Fiji \ndataset using LOOCV for Fiji typhoons')
plt.tight_layout()
plt.show()
```



![png](04.1_simple_model_combined_data_tuning_windspeed_files/04.1_simple_model_combined_data_tuning_windspeed_12_0.png)
