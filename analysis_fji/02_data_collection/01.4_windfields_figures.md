```python
from pathlib import Path
import os

from climada.hazard import Centroids, TCTracks, TropCyclone
from shapely.geometry import LineString, Polygon
import geopandas as gpd
import numpy as np
import pandas as pd
import xarray as xr
import matplotlib.pyplot as plt
from matplotlib.patches import Patch
import warnings

# Ignore specific UserWarnings globally
warnings.filterwarnings("ignore", message="Geometry is in a geographic CRS.*")
warnings.filterwarnings("ignore", message="Use 'GeoSeries.to_crs()'.*")
```


```python
DEG_TO_KM = 111.1  # Convert 1 degree to km
input_dir = Path(os.getenv("STORM_DATA_DIR")) / "analysis_fji/02_model_features"
fiji_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_model_features/02_housing_damage/input/"
)

# Load Fiji
fiji = gpd.read_file(fiji_dir / "adm2_shp_fixed.gpkg")
fiji = fiji.to_crs('EPSG:4326')

# Load grid
grid = gpd.read_file(input_dir / "02_housing_damage/output/fji_0.1_degree_grid_land_overlap_new.gpkg")
```


```python
windfields = pd.read_csv(input_dir / "01_windfield/windfield_data_fji_new_fixed_interpolated_overlap.csv")
# Load YASA (Fiji historical typhoon)
yasa_id = '2020346S13168'
# Load Track from IbTracks
yasa_track = TCTracks.from_ibtracs_netcdf(storm_id=yasa_id)
```

    2024-02-25 20:08:17,381 - climada.hazard.tc_tracks - WARNING - The cached IBTrACS data set dates from 2023-06-07 23:07:38 (older than 180 days). Very likely, a more recent version is available. Consider manually removing the file /Users/federico/climada/data/IBTrACS.ALL.v04r00.nc and re-running this function, which will download the most recent version of the IBTrACS data set from the official URL.


## Windfield plots


```python
yasa_wind = windfields[windfields.typhoon_name == 'YASA'][
    ['typhoon_name',
     'grid_point_id',
     'wind_speed']].merge(grid, left_on='grid_point_id', right_on='id')
yasa_wind_gpd = gpd.GeoDataFrame(yasa_wind, geometry='geometry')

tc_track = yasa_track.get_track()

points = gpd.points_from_xy(tc_track.lon, tc_track.lat)
track_points = gpd.GeoDataFrame(geometry=points)
tc_track_line = LineString(points)
track_line = gpd.GeoDataFrame(geometry=[tc_track_line])
```


```python
fig, ax = plt.subplots(1,1, figsize=(6,6))
yasa_wind_gpd.plot(ax=ax, column='wind_speed', cmap='Reds', legend=True)
track_line.plot(ax=ax, color='k')
ax.set_xlim(176, 182)
ax.set_ylim(-22, -12)

plt.title('Windspeed YASA \n[m/s]')
plt.show()
```



![png](01.4_windfields_figures_files/01.4_windfields_figures_5_0.png)



## Trigger plots


```python
xmin, xmax, ymin, ymax = 176, 183, -20, -12
fiji_polygon = Polygon([(xmin, ymin), (xmin, ymax), (xmax, ymax), (xmax, ymin)])
fiji_polygon_gpd = gpd.GeoDataFrame(index=[0], geometry=[fiji_polygon])
```


```python
fig, ax = plt.subplots(1,2, figsize=(10,5))

# Track path
tc_track = yasa_track.get_track()

points1 = gpd.points_from_xy(tc_track.lon, tc_track.lat)[:29]
track_points1 = gpd.GeoDataFrame(geometry=points1)
tc_track_line1 = LineString(points1)
track_line1 = gpd.GeoDataFrame(geometry=[tc_track_line1])

points2 = gpd.points_from_xy(tc_track.lon, tc_track.lat)[:34]
track_points2 = gpd.GeoDataFrame(geometry=points2)
tc_track_line2 = LineString(points2)
track_line2 = gpd.GeoDataFrame(geometry=[tc_track_line2])

fiji.plot(ax=ax[0], label='Fiji', color='blue')
fiji_polygon_gpd.plot(ax=ax[0], alpha=0.4, label=' Trigger Polygon', color='blue')
track_points1.plot(ax=ax[0], color='k', alpha=0.6, label='Typhoon track')
track_line1.plot(ax=ax[0], color='k', linewidth=1)

fiji.plot(ax=ax[1], label='Fiji', color='blue')
fiji_polygon_gpd.plot(ax=ax[1], alpha=0.4, label=' Trigger Polygon', color='red')
track_points2.plot(ax=ax[1], color='k', alpha=0.6, label='Typhoon track')
track_line2.plot(ax=ax[1], color='k', linewidth=1)

ax[0].set_xlim(173, 185)
ax[0].set_ylim(-22, -8)
ax[0].set_xlabel('Latitude')
ax[0].set_ylabel('Longitude')
ax[0].set_title('Waiting for event')
ax[1].set_xlim(173, 185)
ax[1].set_ylim(-22, -8)
ax[1].set_xlabel('Latitude')
ax[1].set_ylabel('Longitude')
ax[1].set_title('Trigger Activated')


# Create custom legend handles
legend_handles1 = [
    Patch(facecolor='blue', edgecolor='none', label='Fiji'),
    Patch(facecolor='blue', edgecolor='none', alpha=0.4, label='Trigger Polygon'),
    plt.Line2D([], [], color='black', marker='o', alpha=0.6, markersize=5, linestyle='None', label='Event Datapoints')
]

legend_handles2 = [
    Patch(facecolor='blue', edgecolor='none', label='Fiji'),
    Patch(facecolor='red', edgecolor='none', alpha=0.4, label='Trigger Polygon'),
    plt.Line2D([], [], color='black', marker='o', alpha=0.6, markersize=5, linestyle='None', label='Event Datapoints')
]

# Add custom legend
ax[0].legend(handles=legend_handles1)
ax[1].legend(handles=legend_handles2)

plt.tight_layout()
plt.show()
```



![png](01.4_windfields_figures_files/01.4_windfields_figures_8_0.png)
