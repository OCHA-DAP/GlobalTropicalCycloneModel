```python
from pathlib import Path
import os

from shapely.geometry import LineString,Polygon, MultiPolygon
import geopandas as gpd
import numpy as np
import pandas as pd
import xarray as xr
import re
import matplotlib.pyplot as plt
from matplotlib.patches import Patch
from matplotlib.lines import Line2D
from scipy import stats
```


```python
input_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_model_features/02_housing_damage/input/"
)
output_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_model_features/02_housing_damage/output/"
)

bld_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_model_features/06_settlement/output/"
)

# Load Fiji
fiji = gpd.read_file(input_dir / "adm2_shp_fixed.gpkg")
fiji = fiji.to_crs('EPSG:4326')

# Load grid
grid_land_overlap = gpd.read_file(output_dir / "fji_0.1_degree_grid_land_overlap_new.gpkg")
grid_land_overlap["id"] = grid_land_overlap["id"].astype(int)

# Load grids per Municipality
ids_mun = pd.read_csv(input_dir / "grid_municipality_info.csv")

# Load damage data
damage_data = pd.read_csv(input_dir / "fji_building_damage_mun_complete_fix.csv")

```


```python
fji_bld_centroid_grid_count = pd.read_csv(bld_dir / 'fji_population_data_new_approach.csv')
fji_bld_centroid_grid_count = fji_bld_centroid_grid_count.rename({'N_bld':'numbuildings'}, axis=1)
fji_bld_centroid_grid_count.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>Centroid</th>
      <th>geometry</th>
      <th>total_pop</th>
      <th>numbuildings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1981</td>
      <td>178.45E_-18.15N</td>
      <td>POLYGON ((178.3999999999999 -18.09999999999994...</td>
      <td>107468.0</td>
      <td>17899.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2081</td>
      <td>178.55E_-18.05N</td>
      <td>POLYGON ((178.4999999999999 -17.99999999999994...</td>
      <td>75152.0</td>
      <td>14357.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1980</td>
      <td>178.45E_-18.05N</td>
      <td>POLYGON ((178.3999999999999 -17.99999999999994...</td>
      <td>66855.0</td>
      <td>11833.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>966</td>
      <td>177.45E_-17.65N</td>
      <td>POLYGON ((177.39999999999995 -17.5999999999999...</td>
      <td>63805.0</td>
      <td>12504.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>967</td>
      <td>177.45E_-17.75N</td>
      <td>POLYGON ((177.39999999999995 -17.6999999999999...</td>
      <td>39947.0</td>
      <td>7823.0</td>
    </tr>
  </tbody>
</table>
</div>



### Distribution of total houses per grid cell


```python
build_per_grid = fji_bld_centroid_grid_count.numbuildings
plt.hist(build_per_grid, bins=50)
plt.xlabel('Buildings per grid cell')
plt.ylabel('Frequency')


q25 = np.quantile(build_per_grid, 0.25)
q50 = np.quantile(build_per_grid, 0.50)
mode = stats.mode(build_per_grid).mode

# Add text boxes with annotations
plt.text(0.7, 0.9, f'Quantile 25: {q25:.2f}', transform=plt.gca().transAxes)
plt.text(0.7, 0.85, f'Quantile 50: {q50:.2f}', transform=plt.gca().transAxes)
plt.text(0.7, 0.8, f'Mode: {mode:.2f}', transform=plt.gca().transAxes)

plt.show()
```



![png](02.1_damage_agg_by_building_from_urban_rural_using_pop_files/02.1_damage_agg_by_building_from_urban_rural_using_pop_4_0.png)




```python
# Save it
buildings_by_grid = fji_bld_centroid_grid_count[['id','numbuildings']]
buildings_by_grid.to_csv(output_dir / "num_building_bygrid_from_urban_rural_using_pop.csv", index=False)
```

### Building damage to grid

First, let's add some missing information to our dataset


```python
# Define Municipalities in Provinces
east = ['Kadavu', 'Lau', 'Lomaiviti', 'Rotuma']
north =  ['Macuata', 'Cakaudrove', 'Bua']
west =  ['Ba', 'Nadroga/Navosa', 'Ra']
central = ['Naitasiri', 'Namosi', 'Rewa', 'Serua', 'Tailevu']

# Define the division-to-province mapping
division_to_province = {
    'Northern Division': north,
    'Western Division': west,
    'Central Division': central,
    'Eastern Division': east
}

ids_mun['NAME_1'] = ids_mun['NAME_2'].map({municipality: division for division, municipalities in division_to_province.items() for municipality in municipalities})
ids_mun.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>NAME_2</th>
      <th>NAME_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1172</td>
      <td>Nadroga/Navosa</td>
      <td>Western Division</td>
    </tr>
    <tr>
      <th>1</th>
      <td>970</td>
      <td>Nadroga/Navosa</td>
      <td>Western Division</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1068</td>
      <td>Ba</td>
      <td>Western Division</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2672</td>
      <td>Macuata</td>
      <td>Northern Division</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2571</td>
      <td>Macuata</td>
      <td>Northern Division</td>
    </tr>
  </tbody>
</table>
</div>




```python
# Municipalities by id
mun_dict = ids_mun[['id', 'NAME_2']].groupby(by='NAME_2').groups
muns =  mun_dict.keys()
ids = []
for m in muns:
    ids.append(ids_mun.iloc[mun_dict[m].values].id)
df_muns = pd.DataFrame({'Municipality': muns, 'ids':ids})
provinces_exploded = df_muns.explode('ids')

# Regions by id
region_dict = ids_mun[['id', 'NAME_1']].groupby(by='NAME_1').groups
regions =  region_dict.keys()
ids = []
for r in regions:
    ids.append(ids_mun.iloc[region_dict[r].values].id)
df_regions = pd.DataFrame({'Region': regions, 'ids':ids})
regions_exploded = df_regions.explode('ids')
```


```python
# Some checks
print(len(set(ids_mun.sort_values('id').id.unique()) & set(fji_bld_centroid_grid_count.id.unique())))
print(len(set(provinces_exploded.sort_values('ids').ids.unique()) & set(fji_bld_centroid_grid_count.id.unique())))
```

    421
    421



```python
# Assign municipality to fji_bld_centroid_grid_count
bld_grid_mun = fji_bld_centroid_grid_count.merge(provinces_exploded, left_on='id', right_on='ids', how='inner')[['id', 'Municipality', 'numbuildings']]

# Assign region to building count
bld_grid_region = fji_bld_centroid_grid_count.merge(regions_exploded, left_on='id', right_on='ids', how='inner')[['id', 'Region', 'numbuildings']]


bld_grid_region.sort_values('numbuildings', ascending=False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>Region</th>
      <th>numbuildings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1981</td>
      <td>Central Division</td>
      <td>17899.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2081</td>
      <td>Central Division</td>
      <td>14357.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>966</td>
      <td>Western Division</td>
      <td>12504.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1980</td>
      <td>Central Division</td>
      <td>11833.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>967</td>
      <td>Western Division</td>
      <td>7823.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>305</th>
      <td>5123</td>
      <td>Eastern Division</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>306</th>
      <td>5221</td>
      <td>Eastern Division</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307</th>
      <td>5223</td>
      <td>Eastern Division</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>308</th>
      <td>4838</td>
      <td>Eastern Division</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>420</th>
      <td>2369</td>
      <td>Northern Division</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>421 rows × 3 columns</p>
</div>




```python
# Because I can: builings by Municipality

df_aux = bld_grid_mun.groupby('Municipality').sum().sort_values(by='numbuildings', ascending=False)

plt.figure(figsize=(12, 6))
plt.bar(df_aux.index, df_aux['numbuildings'])
plt.xlabel('Municipality')
plt.ylabel('Number of Buildings')
plt.title('Number of Buildings by Municipality')
plt.xticks(rotation=45)

plt.show()
```



![png](02.1_damage_agg_by_building_from_urban_rural_using_pop_files/02.1_damage_agg_by_building_from_urban_rural_using_pop_12_0.png)




```python
# Total number of buildings per mun
total_bld_mun = bld_grid_mun.groupby('Municipality').sum()['numbuildings'].reset_index(drop=False)
bld_grid_mun_merged = bld_grid_mun.merge(total_bld_mun, on='Municipality', how='left')

# Total number of buildings per region
total_bld_reg = bld_grid_region.groupby('Region').sum()['numbuildings'].reset_index(drop=False)
bld_grid_reg_merged = bld_grid_region.merge(total_bld_reg, on='Region', how='left')

```


```python
# Separate typhoons by admin
adm1_typhoons_dmg = damage_data[damage_data.isna().any(axis=1)]
adm2_typhoons_dmg = damage_data.dropna()

adm1_typhoons = adm1_typhoons_dmg.typhoon.unique()
adm2_typhoons = adm2_typhoons_dmg.typhoon.unique()
```


```python
# Merge damage and bld data
bld_damage_merged_adm1 = adm1_typhoons_dmg.merge(bld_grid_reg_merged, left_on='ADM1_NAME', right_on='Region')
bld_damage_merged_adm2 = adm2_typhoons_dmg.merge(bld_grid_mun_merged, left_on='ADM2_NAME', right_on='Municipality')
```


```python
bld_grid_mun
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>Municipality</th>
      <th>numbuildings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1981</td>
      <td>Rewa</td>
      <td>17899.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2081</td>
      <td>Rewa</td>
      <td>14357.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1980</td>
      <td>Naitasiri</td>
      <td>11833.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>966</td>
      <td>Ba</td>
      <td>12504.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>967</td>
      <td>Ba</td>
      <td>7823.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>416</th>
      <td>1676</td>
      <td>Naitasiri</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>417</th>
      <td>1675</td>
      <td>Naitasiri</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>418</th>
      <td>1669</td>
      <td>Ra</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>419</th>
      <td>3375</td>
      <td>Macuata</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>420</th>
      <td>2369</td>
      <td>Macuata</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>421 rows × 3 columns</p>
</div>




```python
# % of damage

# ADM1 typhoons
bld_damage_merged_total_adm1 = pd.DataFrame()
bld_dmg_aux = bld_damage_merged_adm1.drop_duplicates(['typhoon', 'Year'])
for typhoon, year in zip(bld_dmg_aux['typhoon'], bld_dmg_aux['Year']):
    bld_damage_merged_set_regions = bld_damage_merged_adm1.loc[(bld_damage_merged_adm1.typhoon == typhoon) & (bld_damage_merged_adm1.Year == year)].copy()
    # Total number of buildings in the set of regions
    #bld_damage_merged_set_regions['numbuildings_z'] = bld_damage_merged_set_regions.numbuildings_y.unique().sum()
    bld_damage_merged_set_regions['numbuildings_z'] = bld_damage_merged_set_regions['numbuildings_y'] # Here's the damage is just at adm1
    # Density of buildings per cell for every typhoon
    bld_damage_merged_set_regions['frac_bld'] = bld_damage_merged_set_regions['numbuildings_x'] / bld_damage_merged_set_regions['numbuildings_z']
    # Create percentage of damage per grid cell
    bld_damage_merged_set_regions['perc_dmg_grid'] = bld_damage_merged_set_regions['frac_bld'] * bld_damage_merged_set_regions['total'] * 100 / bld_damage_merged_set_regions['numbuildings_z']

    # For every typhoon, put 0 damage to the grid cells not affected by the typhoon
    df_aux3 = bld_damage_merged_set_regions.merge(bld_grid_region, on='id', how='right')
    df_aux3['typhoon_name'] = df_aux3.typhoon.fillna(typhoon)
    df_aux3['Year'] = df_aux3.Year.fillna(year)
    df_aux3 = df_aux3.rename({'Region_y': 'Region'}, axis=1)
    bld_damage_merged_set_regions_total = df_aux3.fillna(0)

    bld_damage_merged_total_adm1 = pd.concat([bld_damage_merged_total_adm1, bld_damage_merged_set_regions_total])

# ADM2 typhoons
bld_damage_merged_total_adm2 = pd.DataFrame()
bld_dmg_aux = bld_damage_merged_adm2.drop_duplicates(['typhoon', 'Year'])
for typhoon, year in zip(bld_dmg_aux['typhoon'], bld_dmg_aux['Year']):
    bld_damage_merged_set_regions = bld_damage_merged_adm2.loc[(bld_damage_merged_adm2['typhoon'] == typhoon) & (bld_damage_merged_adm2.Year == year)].copy()
    # Total number of buildings in the set of regions
    #bld_damage_merged_set_regions['numbuildings_z'] = bld_damage_merged_set_regions.numbuildings_y.unique().sum()
    bld_damage_merged_set_regions['numbuildings_z'] = bld_damage_merged_set_regions['numbuildings_y'] # Here's the damage is just at adm2
    # Density of buildings per cell for every typhoon
    bld_damage_merged_set_regions['frac_bld'] = bld_damage_merged_set_regions['numbuildings_x'] / bld_damage_merged_set_regions['numbuildings_z']
    # Create percentage of damage per grid cell
    bld_damage_merged_set_regions['perc_dmg_grid'] = bld_damage_merged_set_regions['frac_bld'] * bld_damage_merged_set_regions['total'] * 100 / bld_damage_merged_set_regions['numbuildings_z']

    # For every typhoon, put 0 damage to the grid cells not affected by the typhoon
    df_aux3 = bld_damage_merged_set_regions.merge(bld_grid_mun, on='id', how='right')
    df_aux3['typhoon_name'] = df_aux3.typhoon.fillna(typhoon)
    df_aux3['Year'] = df_aux3.Year.fillna(year)
    df_aux3 = df_aux3.rename({'Municipality_y': 'Municipality'}, axis=1)
    bld_damage_merged_set_regions_total = df_aux3.fillna(0)

    bld_damage_merged_total_adm2 = pd.concat([bld_damage_merged_total_adm2, bld_damage_merged_set_regions_total])
```


```python
# Total df (adm1 + adm2)
bld_damage_merged_total = pd.concat([bld_damage_merged_total_adm2, bld_damage_merged_total_adm1]).drop(
    ['Unnamed: 0', 'ADM1_NAME', 'ADM2_NAME', 'typhoon', 'Municipality_x', 'Region_x', 'Region', 'Municipality'], axis=1)

```

### Some checks


```python
bld_damage_merged_total.typhoon_name.unique()
```




    array(['Winston', 'Harold', 'Ana', 'Yasa', 'Gita', 'Sarai', 'Tino',
           'Evan', 'Tomas'], dtype=object)




```python
bld_damage_merged_total[bld_damage_merged_total.isna().any(axis=1)]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Totally</th>
      <th>Partially</th>
      <th>total</th>
      <th>id</th>
      <th>numbuildings_x</th>
      <th>numbuildings_y</th>
      <th>numbuildings_z</th>
      <th>frac_bld</th>
      <th>perc_dmg_grid</th>
      <th>numbuildings</th>
      <th>typhoon_name</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>




```python
plt.hist(bld_damage_merged_total.perc_dmg_grid)

plt.title('Distribution of damage')
plt.yscale('log')
plt.xlabel('% of damage by grid')
plt.show()
```



![png](02.1_damage_agg_by_building_from_urban_rural_using_pop_files/02.1_damage_agg_by_building_from_urban_rural_using_pop_22_0.png)



### Save % of damage per grid cell


```python
bld_damage_merged_total
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Totally</th>
      <th>Partially</th>
      <th>total</th>
      <th>id</th>
      <th>numbuildings_x</th>
      <th>numbuildings_y</th>
      <th>numbuildings_z</th>
      <th>frac_bld</th>
      <th>perc_dmg_grid</th>
      <th>numbuildings</th>
      <th>typhoon_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016.0</td>
      <td>66.0</td>
      <td>78.0</td>
      <td>144.0</td>
      <td>1981</td>
      <td>17899.0</td>
      <td>34529.0</td>
      <td>34529.0</td>
      <td>0.518376</td>
      <td>0.216184</td>
      <td>17899.0</td>
      <td>Winston</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016.0</td>
      <td>66.0</td>
      <td>78.0</td>
      <td>144.0</td>
      <td>2081</td>
      <td>14357.0</td>
      <td>34529.0</td>
      <td>34529.0</td>
      <td>0.415795</td>
      <td>0.173404</td>
      <td>14357.0</td>
      <td>Winston</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016.0</td>
      <td>542.0</td>
      <td>365.0</td>
      <td>907.0</td>
      <td>1980</td>
      <td>11833.0</td>
      <td>16675.0</td>
      <td>16675.0</td>
      <td>0.709625</td>
      <td>3.859850</td>
      <td>11833.0</td>
      <td>Winston</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016.0</td>
      <td>3494.0</td>
      <td>4241.0</td>
      <td>7735.0</td>
      <td>966</td>
      <td>12504.0</td>
      <td>47882.0</td>
      <td>47882.0</td>
      <td>0.261142</td>
      <td>4.218565</td>
      <td>12504.0</td>
      <td>Winston</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016.0</td>
      <td>3494.0</td>
      <td>4241.0</td>
      <td>7735.0</td>
      <td>967</td>
      <td>7823.0</td>
      <td>47882.0</td>
      <td>47882.0</td>
      <td>0.163381</td>
      <td>2.639302</td>
      <td>7823.0</td>
      <td>Winston</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>416</th>
      <td>2010.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1676</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Tomas</td>
    </tr>
    <tr>
      <th>417</th>
      <td>2010.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1675</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Tomas</td>
    </tr>
    <tr>
      <th>418</th>
      <td>2010.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1669</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Tomas</td>
    </tr>
    <tr>
      <th>419</th>
      <td>2010.0</td>
      <td>97.0</td>
      <td>0.0</td>
      <td>97.0</td>
      <td>3375</td>
      <td>0.0</td>
      <td>27368.0</td>
      <td>27368.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Tomas</td>
    </tr>
    <tr>
      <th>420</th>
      <td>2010.0</td>
      <td>97.0</td>
      <td>0.0</td>
      <td>97.0</td>
      <td>2369</td>
      <td>0.0</td>
      <td>27368.0</td>
      <td>27368.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Tomas</td>
    </tr>
  </tbody>
</table>
<p>3789 rows × 12 columns</p>
</div>




```python
bld_damage_merged_total.to_csv(output_dir / "building_damage_bygrid_new_rural_urban_bld_using_pop.csv", index=False)
```
