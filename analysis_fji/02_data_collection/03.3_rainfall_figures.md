```python
from pathlib import Path
import os

from climada.hazard import Centroids, TCTracks, TropCyclone
from shapely.geometry import LineString, Polygon
import geopandas as gpd
import numpy as np
import pandas as pd
import xarray as xr
import matplotlib.pyplot as plt
from matplotlib.patches import Patch
import warnings
```


```python
output_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_model_features/03_rainfall/output"
)

input_dir = Path(os.getenv("STORM_DATA_DIR")) / "analysis_fji/02_model_features"
fiji_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_fji/02_model_features/02_housing_damage/input/"
)

# Load Fiji
fiji = gpd.read_file(fiji_dir / "adm2_shp_fixed.gpkg")
fiji = fiji.to_crs('EPSG:4326')

# Load grid
grid = gpd.read_file(input_dir / "02_housing_damage/output/fji_0.1_degree_grid_land_overlap_new.gpkg")

# Load rainfall
rain = pd.read_csv(output_dir / 'rainfall_data_rw_mean.csv')
```

## Plot rainfall


```python
yasa_rain = rain[rain.typhoon == 'yasa2020'].merge(grid, on='id')
# Load YASA (Fiji historical typhoon)
yasa_id = '2020346S13168'
# Load Track from IbTracks
yasa_track = TCTracks.from_ibtracs_netcdf(storm_id=yasa_id)
```

    2024-02-25 20:27:38,709 - climada.hazard.tc_tracks - WARNING - The cached IBTrACS data set dates from 2023-06-07 23:07:38 (older than 180 days). Very likely, a more recent version is available. Consider manually removing the file /Users/federico/climada/data/IBTrACS.ALL.v04r00.nc and re-running this function, which will download the most recent version of the IBTrACS data set from the official URL.



```python
yasa_rain_gpd = gpd.GeoDataFrame(yasa_rain, geometry='geometry')

tc_track = yasa_track.get_track()
points = gpd.points_from_xy(tc_track.lon, tc_track.lat)
track_points = gpd.GeoDataFrame(geometry=points)
tc_track_line = LineString(points)
track_line = gpd.GeoDataFrame(geometry=[tc_track_line])
```


```python
fig, ax = plt.subplots(1,1, figsize=(6,6))
yasa_rain_gpd.plot(ax=ax, column='rainfall_max_6h', cmap='Reds', legend=True)
track_line.plot(ax=ax, color='k')
ax.set_xlim(176, 182)
ax.set_ylim(-22, -12)

plt.title('Max Accumulated Rainfall in 24h, YASA \n[mm]')
plt.show()
```



![png](03.3_rainfall_figures_files/03.3_rainfall_figures_5_0.png)
