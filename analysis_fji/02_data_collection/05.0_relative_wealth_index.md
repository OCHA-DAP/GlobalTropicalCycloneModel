# Mean International Wealth Index

- For Fiji `https://globaldatalab.org/areadata/table/iwi/FJI/`


```python
import pandas as pd
import geopandas as gpd
from pathlib import Path
import matplotlib.pyplot as plt
import os
```


```python
base_dir = Path(os.getenv("STORM_DATA_DIR")) / "analysis_fji/02_new_model_input/"
input_dir = base_dir / "05_vulnerablility/input/"
shp_input_dir = base_dir / "02_housing_damage/output/"
output_dir = base_dir / "05_vulnerablility/output/"

# Load ids of municipalities
ids_mun = pd.read_csv(base_dir / "02_housing_damage/input/grid_municipality_info.csv")

# Load grids
grid = gpd.read_file(base_dir / "02_housing_damage/output/fji_0.1_degree_grid_land_overlap_new.gpkg")

# Load RWI
fji_rwi = pd.read_csv(input_dir / "GDL-Mean-International-Wealth-Index-(IWI)-score-of-region-data.csv")

# Load Fiji
adm2_shp = gpd.read_file(base_dir / "02_housing_damage/input/adm2_shp_fixed.gpkg")
adm2_shp = adm2_shp.to_crs('EPSG:4326')
```


```python
fji_rwi
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Continent</th>
      <th>ISO_Code</th>
      <th>Level</th>
      <th>GDLCODE</th>
      <th>Region</th>
      <th>1992</th>
      <th>1993</th>
      <th>1994</th>
      <th>1995</th>
      <th>...</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>National</td>
      <td>FJIt</td>
      <td>Total</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>75.5</td>
      <td>76.3</td>
      <td>77.0</td>
      <td>77.8</td>
      <td>78.6</td>
      <td>79.3</td>
      <td>80.1</td>
      <td>80.9</td>
      <td>81.7</td>
      <td>82.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr108</td>
      <td>Ba</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>81.9</td>
      <td>82.4</td>
      <td>82.8</td>
      <td>83.3</td>
      <td>83.8</td>
      <td>84.2</td>
      <td>84.7</td>
      <td>85.1</td>
      <td>85.6</td>
      <td>86.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr106</td>
      <td>Cakaudrove, Bua</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>59.4</td>
      <td>61.1</td>
      <td>62.8</td>
      <td>64.5</td>
      <td>66.2</td>
      <td>67.9</td>
      <td>69.6</td>
      <td>71.3</td>
      <td>73.0</td>
      <td>74.7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr105</td>
      <td>Kadavu, Lau, Lomaiviti, Rotuma</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>57.5</td>
      <td>59.1</td>
      <td>60.6</td>
      <td>62.1</td>
      <td>63.7</td>
      <td>65.2</td>
      <td>66.8</td>
      <td>68.3</td>
      <td>69.8</td>
      <td>71.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr107</td>
      <td>Macuata</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>74.2</td>
      <td>75.4</td>
      <td>76.7</td>
      <td>77.9</td>
      <td>79.2</td>
      <td>80.4</td>
      <td>81.6</td>
      <td>82.9</td>
      <td>84.1</td>
      <td>85.4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr109</td>
      <td>Nadroga or Navosa</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>68.7</td>
      <td>69.5</td>
      <td>70.3</td>
      <td>71.1</td>
      <td>72.0</td>
      <td>72.8</td>
      <td>73.6</td>
      <td>74.4</td>
      <td>75.3</td>
      <td>76.1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr101</td>
      <td>Naitasiri</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>80.7</td>
      <td>81.3</td>
      <td>81.8</td>
      <td>82.3</td>
      <td>82.8</td>
      <td>83.3</td>
      <td>83.8</td>
      <td>84.3</td>
      <td>84.9</td>
      <td>85.4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr110</td>
      <td>Ra</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>61.3</td>
      <td>62.6</td>
      <td>63.9</td>
      <td>65.2</td>
      <td>66.5</td>
      <td>67.8</td>
      <td>69.1</td>
      <td>70.4</td>
      <td>71.7</td>
      <td>73.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr102</td>
      <td>Rewa</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>81.0</td>
      <td>81.1</td>
      <td>81.2</td>
      <td>81.4</td>
      <td>81.5</td>
      <td>81.6</td>
      <td>81.8</td>
      <td>81.9</td>
      <td>82.0</td>
      <td>82.2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr103</td>
      <td>Serua, Namosi</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>73.1</td>
      <td>73.7</td>
      <td>74.3</td>
      <td>74.9</td>
      <td>75.4</td>
      <td>76.0</td>
      <td>76.6</td>
      <td>77.2</td>
      <td>77.8</td>
      <td>78.4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Fiji</td>
      <td>Asia/Pacific</td>
      <td>FJI</td>
      <td>Subnat</td>
      <td>FJIr104</td>
      <td>Tailevu</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>70.9</td>
      <td>71.8</td>
      <td>72.7</td>
      <td>73.7</td>
      <td>74.6</td>
      <td>75.6</td>
      <td>76.5</td>
      <td>77.4</td>
      <td>78.4</td>
      <td>79.3</td>
    </tr>
  </tbody>
</table>
<p>11 rows Ã— 37 columns</p>
</div>



### Do I need to distinguish between the year?


```python
y2013 = fji_rwi['2013']
y2015 = fji_rwi['2015']
y2017 = fji_rwi['2017']
y2019 = fji_rwi['2019']
y2022 = fji_rwi['2022']
fig, ax = plt.subplots(2,2)
ax = ax.flatten()

ax[0].plot(y2013,y2015, 'o')
ax[0].set_xlabel('IWI 2013')
ax[0].set_ylabel('IWI 2015')
ax[1].plot(y2015,y2017, 'o')
ax[1].set_xlabel('IWI 2015')
ax[1].set_ylabel('IWI 2017')
ax[2].plot(y2017,y2019, 'o')
ax[2].set_xlabel('IWI 2017')
ax[2].set_ylabel('IWI 2019')
ax[3].plot(y2019,y2022, 'o')
ax[3].set_xlabel('IWI 2019')
ax[3].set_ylabel('IWI 2012')

plt.tight_layout()
plt.show()
```



![png](05.0_relative_wealth_index_files/05.0_relative_wealth_index_6_0.png)



Nop. Its the same, they are all correlated. Lets work with the IWI 2022 since its the last one

### Municipality to grid cell

Keep in mind that I'm not distributing the IWI across each grid cell, because its a fix value for the Province. So, each grid cell of a municipality has the same value as the municipality.


```python
# IWI per municipality
expanded_rows = []

# Iterate through the rows of the original DataFrame
for index, row in fji_rwi.iterrows():
    regions = row["Region"].split(', ')  # Split the regions if there are multiple

    if len(regions) == 1:
        # If there is only one region, add the row as it is
        expanded_rows.append(row)
    else:
        # If there are multiple regions, create a new row for each region
        for region in regions:
            new_row = row.copy()
            new_row["Region"] = region
            expanded_rows.append(new_row)

expanded_df = pd.DataFrame(expanded_rows).iloc[1:].reset_index(drop=True) # Drop 'Total IWI'
expanded_df["Region"] = expanded_df["Region"].replace("Nadroga or Navosa", "Nadroga/Navosa")

# Municipality Ids
mun_dict = ids_mun[['id', 'NAME_2']].groupby(by='NAME_2').groups
muns =  mun_dict.keys()
ids = []
for m in muns:
    ids.append(ids_mun.iloc[mun_dict[m].values].id)
df_muns = pd.DataFrame({'Municipality': muns, 'ids':ids})

# Merge datasets
df_merged = df_muns.merge(expanded_df, left_on='Municipality', right_on='Region', how='left')[['Municipality', '2022', 'ids']]
exploded_merged = df_merged.explode('ids')

# Save it
IWI_fji = exploded_merged[['ids', '2022']].rename({'ids':'grid_point_id', '2022':'IWI'}, axis=1)
IWI_fji.to_csv(output_dir / "fji_rwi_bygrid_new.csv", index=False)

```

## Plot IWI



```python
df_map_merge = adm2_shp.merge(df_merged, left_on='NAME_2', right_on='Municipality', how='right')

# Set up the figure and axis
fig, ax = plt.subplots(1, 1, figsize=(6, 6))

# Plot the GeoDataFrame and use the '2022' column for coloring
df_map_merge.plot(column='2022', cmap='viridis', linewidth=0.8, ax=ax, legend=True)

# Customize the plot (e.g., add a title)
ax.set_title('Municipality Coloring by IWI')
ax.set_xlabel('Longitude')
ax.set_ylabel('Latitude')
# Show the plot
plt.show()
```



![png](05.0_relative_wealth_index_files/05.0_relative_wealth_index_12_0.png)
