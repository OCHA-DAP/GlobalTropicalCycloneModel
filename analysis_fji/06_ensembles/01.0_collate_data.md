# Gather the data needed to train the model

In this notebook we combine all of the data from
step 2. The contents of this notebook is mirrored
in `utils.py` so that it can be used in other notebooks.


```python
from pathlib import Path
import os
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
```


```python
input_dir = Path(os.getenv("STORM_DATA_DIR")) / "analysis_fji/02_model_features"
output_dir = (
    Path(os.getenv("STORM_DATA_DIR")) / "analysis_fji/03_model_input_dataset"
)
```

## Read in buliding damage


```python
# Read in the building damage data
filename = input_dir / "02_housing_damage/output/building_damage_bygrid_new_rural_urban_bld_using_pop.csv"
df_damage = pd.read_csv(filename)

# Read in buildings per grid
filename = input_dir / "02_housing_damage/output/num_building_bygrid_from_urban_rural_using_pop.csv"
df_buildings_raw = pd.read_csv(filename)
```


```python
df_damage.sort_values('perc_dmg_grid')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Totally</th>
      <th>Partially</th>
      <th>total</th>
      <th>id</th>
      <th>numbuildings_x</th>
      <th>numbuildings_y</th>
      <th>numbuildings_z</th>
      <th>frac_bld</th>
      <th>perc_dmg_grid</th>
      <th>numbuildings</th>
      <th>typhoon_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1894</th>
      <td>2018.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2976</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>68.0</td>
      <td>Gita</td>
    </tr>
    <tr>
      <th>2373</th>
      <td>2019.0</td>
      <td>8.0</td>
      <td>26.0</td>
      <td>34.0</td>
      <td>1177</td>
      <td>0.0</td>
      <td>64821.0</td>
      <td>64821.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Sarai</td>
    </tr>
    <tr>
      <th>2374</th>
      <td>2019.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3680</td>
      <td>0.0</td>
      <td>27368.0</td>
      <td>27368.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Sarai</td>
    </tr>
    <tr>
      <th>2375</th>
      <td>2019.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3683</td>
      <td>0.0</td>
      <td>27368.0</td>
      <td>27368.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Sarai</td>
    </tr>
    <tr>
      <th>2376</th>
      <td>2019.0</td>
      <td>8.0</td>
      <td>26.0</td>
      <td>34.0</td>
      <td>1059</td>
      <td>0.0</td>
      <td>64821.0</td>
      <td>64821.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>Sarai</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>563</th>
      <td>2020.0</td>
      <td>572.0</td>
      <td>1006.0</td>
      <td>1578.0</td>
      <td>1989</td>
      <td>185.0</td>
      <td>1570.0</td>
      <td>1570.0</td>
      <td>0.117834</td>
      <td>11.843482</td>
      <td>185.0</td>
      <td>Harold</td>
    </tr>
    <tr>
      <th>554</th>
      <td>2020.0</td>
      <td>572.0</td>
      <td>1006.0</td>
      <td>1578.0</td>
      <td>1687</td>
      <td>206.0</td>
      <td>1570.0</td>
      <td>1570.0</td>
      <td>0.131210</td>
      <td>13.187878</td>
      <td>206.0</td>
      <td>Harold</td>
    </tr>
    <tr>
      <th>1270</th>
      <td>2020.0</td>
      <td>565.0</td>
      <td>3456.0</td>
      <td>4021.0</td>
      <td>2873</td>
      <td>3715.0</td>
      <td>9841.0</td>
      <td>9841.0</td>
      <td>0.377502</td>
      <td>15.424618</td>
      <td>3715.0</td>
      <td>Yasa</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2016.0</td>
      <td>2813.0</td>
      <td>757.0</td>
      <td>3570.0</td>
      <td>1670</td>
      <td>1693.0</td>
      <td>6148.0</td>
      <td>6148.0</td>
      <td>0.275374</td>
      <td>15.990331</td>
      <td>1693.0</td>
      <td>Winston</td>
    </tr>
    <tr>
      <th>501</th>
      <td>2020.0</td>
      <td>572.0</td>
      <td>1006.0</td>
      <td>1578.0</td>
      <td>1587</td>
      <td>348.0</td>
      <td>1570.0</td>
      <td>1570.0</td>
      <td>0.221656</td>
      <td>22.278551</td>
      <td>348.0</td>
      <td>Harold</td>
    </tr>
  </tbody>
</table>
<p>3789 rows × 12 columns</p>
</div>




```python
# Select and rename columns in the damage dataset
# drop any rows that don't have a typhoon name
columns_to_keep = {
    "id": "grid_point_id",
    "numbuildings_x": "total_buildings",
    "typhoon_name": "typhoon_name",
    "total": "total_buildings_damaged",
    "perc_dmg_grid": "perc_dmg_grid"
}

df_damage = (
    df_damage.dropna(subset="typhoon_name")
    .loc[:, list(columns_to_keep.keys())]
    .rename(columns=columns_to_keep)
)
df_damage["typhoon_name"] = df_damage["typhoon_name"].str.upper()
column_name = "grid_point_id"
df_damage[column_name] = df_damage[column_name].astype(int)

df_damage.sort_values('perc_dmg_grid')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>grid_point_id</th>
      <th>total_buildings</th>
      <th>typhoon_name</th>
      <th>total_buildings_damaged</th>
      <th>perc_dmg_grid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1894</th>
      <td>2976</td>
      <td>0.0</td>
      <td>GITA</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2373</th>
      <td>1177</td>
      <td>0.0</td>
      <td>SARAI</td>
      <td>34.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2374</th>
      <td>3680</td>
      <td>0.0</td>
      <td>SARAI</td>
      <td>4.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2375</th>
      <td>3683</td>
      <td>0.0</td>
      <td>SARAI</td>
      <td>4.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2376</th>
      <td>1059</td>
      <td>0.0</td>
      <td>SARAI</td>
      <td>34.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>563</th>
      <td>1989</td>
      <td>185.0</td>
      <td>HAROLD</td>
      <td>1578.0</td>
      <td>11.843482</td>
    </tr>
    <tr>
      <th>554</th>
      <td>1687</td>
      <td>206.0</td>
      <td>HAROLD</td>
      <td>1578.0</td>
      <td>13.187878</td>
    </tr>
    <tr>
      <th>1270</th>
      <td>2873</td>
      <td>3715.0</td>
      <td>YASA</td>
      <td>4021.0</td>
      <td>15.424618</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1670</td>
      <td>1693.0</td>
      <td>WINSTON</td>
      <td>3570.0</td>
      <td>15.990331</td>
    </tr>
    <tr>
      <th>501</th>
      <td>1587</td>
      <td>348.0</td>
      <td>HAROLD</td>
      <td>1578.0</td>
      <td>22.278551</td>
    </tr>
  </tbody>
</table>
<p>3789 rows × 5 columns</p>
</div>




```python
len(df_damage.grid_point_id.unique())
```




    421




```python
# Rename colums in the buildings dataset
df_buildings = df_buildings_raw[['id','numbuildings']].rename({'id':'grid_point_id', 'numbuildings':'total_buildings'},axis=1)
```


```python
df_buildings
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>grid_point_id</th>
      <th>total_buildings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1981</td>
      <td>17899.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2081</td>
      <td>14357.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1980</td>
      <td>11833.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>966</td>
      <td>12504.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>967</td>
      <td>7823.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>416</th>
      <td>1676</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>417</th>
      <td>1675</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>418</th>
      <td>1669</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>419</th>
      <td>3375</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>420</th>
      <td>2369</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>421 rows × 2 columns</p>
</div>



## Read in windfield


```python
# Read in the data file
filename = input_dir / "01_windfield/windfield_data_fji_synthetic_tracks.csv"

df_windfield = pd.read_csv(filename)
df_windfield.columns
```




    Index(['typhoon_name', 'track_id', 'grid_point_id', 'wind_speed',
           'track_distance', 'id', 'geometry'],
          dtype='object')




```python
# Select columns
columns_to_keep = [
    "typhoon_name",
#    "typhoon_year",
    "grid_point_id",
    "wind_speed",
    "track_distance",
]
df_windfield = df_windfield.loc[:, columns_to_keep]
df_windfield["typhoon_name"] = df_windfield["typhoon_name"].str.upper()
df_windfield
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>typhoon_name</th>
      <th>grid_point_id</th>
      <th>wind_speed</th>
      <th>track_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TOMAS</td>
      <td>355</td>
      <td>0.000000</td>
      <td>33304.408462</td>
    </tr>
    <tr>
      <th>1</th>
      <td>TOMAS_GEN1</td>
      <td>355</td>
      <td>0.000000</td>
      <td>34079.553179</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TOMAS_GEN2</td>
      <td>355</td>
      <td>0.000000</td>
      <td>33327.311782</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TOMAS_GEN3</td>
      <td>355</td>
      <td>0.000000</td>
      <td>33835.936775</td>
    </tr>
    <tr>
      <th>4</th>
      <td>TOMAS_GEN4</td>
      <td>355</td>
      <td>0.000000</td>
      <td>32945.514284</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>22729</th>
      <td>ANA_GEN1</td>
      <td>5331</td>
      <td>12.068875</td>
      <td>248.098963</td>
    </tr>
    <tr>
      <th>22730</th>
      <td>ANA_GEN2</td>
      <td>5331</td>
      <td>0.000000</td>
      <td>339.052070</td>
    </tr>
    <tr>
      <th>22731</th>
      <td>ANA_GEN3</td>
      <td>5331</td>
      <td>0.000000</td>
      <td>368.661849</td>
    </tr>
    <tr>
      <th>22732</th>
      <td>ANA_GEN4</td>
      <td>5331</td>
      <td>11.283163</td>
      <td>259.985173</td>
    </tr>
    <tr>
      <th>22733</th>
      <td>ANA_GEN5</td>
      <td>5331</td>
      <td>0.000000</td>
      <td>450.466329</td>
    </tr>
  </tbody>
</table>
<p>22734 rows × 4 columns</p>
</div>




```python
len(df_windfield.grid_point_id.unique())
```




    421



## Read in rainfall


```python
filename = input_dir / "03_rainfall/output/rainfall_data_rw_mean.csv"
df_rainfall = pd.read_csv(filename)
df_rainfall[["typhoon_name", "typhoon_year"]] = df_rainfall[
    "typhoon"
].str.split("(\d+)", expand=True)[[0, 1]]
df_rainfall["typhoon_name"] = df_rainfall["typhoon_name"].str.upper()
df_rainfall["typhoon_year"] = df_rainfall["typhoon_year"].astype(int)
df_rainfall = df_rainfall.rename(columns={"id": "grid_point_id"}).loc[
    :,
    [
        "typhoon_name",
        "typhoon_year",
        "grid_point_id",
        "rainfall_max_6h",
        "rainfall_max_24h",
        "Centroid"
    ],
]
df_rainfall
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>typhoon_name</th>
      <th>typhoon_year</th>
      <th>grid_point_id</th>
      <th>rainfall_max_6h</th>
      <th>rainfall_max_24h</th>
      <th>Centroid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TOMAS</td>
      <td>2010</td>
      <td>355</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>176.85E_-17.15N</td>
    </tr>
    <tr>
      <th>1</th>
      <td>TOMAS</td>
      <td>2010</td>
      <td>409</td>
      <td>1.866667</td>
      <td>0.612500</td>
      <td>176.95E_-12.45N</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TOMAS</td>
      <td>2010</td>
      <td>456</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>176.95E_-17.15N</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TOMAS</td>
      <td>2010</td>
      <td>510</td>
      <td>3.241667</td>
      <td>1.010417</td>
      <td>177.05E_-12.45N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>TOMAS</td>
      <td>2010</td>
      <td>511</td>
      <td>2.366667</td>
      <td>0.806250</td>
      <td>177.05E_-12.55N</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3784</th>
      <td>ANA</td>
      <td>2021</td>
      <td>5122</td>
      <td>0.666667</td>
      <td>0.362500</td>
      <td>181.55E_-19.15N</td>
    </tr>
    <tr>
      <th>3785</th>
      <td>ANA</td>
      <td>2021</td>
      <td>5123</td>
      <td>0.766667</td>
      <td>0.422917</td>
      <td>181.55E_-19.25N</td>
    </tr>
    <tr>
      <th>3786</th>
      <td>ANA</td>
      <td>2021</td>
      <td>5221</td>
      <td>0.675000</td>
      <td>0.360417</td>
      <td>181.65E_-18.95N</td>
    </tr>
    <tr>
      <th>3787</th>
      <td>ANA</td>
      <td>2021</td>
      <td>5223</td>
      <td>0.900000</td>
      <td>0.437500</td>
      <td>181.65E_-19.15N</td>
    </tr>
    <tr>
      <th>3788</th>
      <td>ANA</td>
      <td>2021</td>
      <td>5331</td>
      <td>1.483333</td>
      <td>0.783333</td>
      <td>181.75E_-19.85N</td>
    </tr>
  </tbody>
</table>
<p>3789 rows × 6 columns</p>
</div>




```python
len(df_rainfall.grid_point_id.unique())
```




    421



## Check grid points ids matches


```python
wind_ids = df_windfield.grid_point_id.unique()
house_ids = df_damage.grid_point_id.unique()
rain_ids = df_rainfall.grid_point_id.unique()
```


```python
len(set(wind_ids) & set(house_ids))
```




    421




```python
len(set(rain_ids) & set(house_ids))
```




    421



Everything is ok!!!!!

## Read in IWI and topography


```python
filename_iwi = input_dir / "05_vulnerablility/output/fji_iwi_bygrid_new.csv"
df_iwi = pd.read_csv(filename_iwi)
```


```python
filename_topo = input_dir / "04_topography/output/topography_variables_bygrid_new.csv"
df_topo = pd.read_csv(filename_topo).rename({'mean_elev': 'mean_altitude'}, axis=1)
```

## Read in Light index


```python
filename_light = input_dir / "05_vulnerablility/output/light_index.csv"
df_light = pd.read_csv(filename_light).rename({'sum': 'light_index'}, axis=1)
```

## Merge the datasets


```python
# Windfield and Rainfall are COMPLETE datasets. Damage has just damage info in the cells where are in fact damage.
index = ["typhoon_name", "grid_point_id"]
object_list = [df_damage, df_rainfall]

# First merge rainfall and damage
df_all = pd.concat(
    objs=[aux.set_index(index) for aux in object_list], axis=1, join="outer"
)

# Now merge the IWI, buildings and Topological data
df_all.reset_index(inplace=True)
merge1 = df_all.merge(df_iwi, on='grid_point_id', how='left')
merge2 = merge1.merge(df_buildings, on='grid_point_id', how='left')
merge3 = merge2.merge(df_topo, left_on='grid_point_id', right_on='id')
df_all = merge3.merge(df_light, left_on='grid_point_id', right_on='id').set_index(index)
df_all = df_all.rename({'total_buildings_y':'total_buildings'}, axis=1)

# Merge with windspeed
df_all.reset_index(inplace=True)
df_all = df_all.merge(df_windfield, how='right', on=['typhoon_name', 'grid_point_id'])
```


```python
df_all[df_all.typhoon_name == 'YASA_GEN1']
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>typhoon_name</th>
      <th>grid_point_id</th>
      <th>total_buildings_x</th>
      <th>total_buildings_damaged</th>
      <th>perc_dmg_grid</th>
      <th>typhoon_year</th>
      <th>rainfall_max_6h</th>
      <th>rainfall_max_24h</th>
      <th>Centroid</th>
      <th>IWI</th>
      <th>total_buildings</th>
      <th>id_x</th>
      <th>with_coast</th>
      <th>coast_length</th>
      <th>mean_altitude</th>
      <th>mean_slope</th>
      <th>id_y</th>
      <th>light_index</th>
      <th>wind_speed</th>
      <th>track_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>43</th>
      <td>YASA_GEN1</td>
      <td>355</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>25.392430</td>
      <td>119.202739</td>
    </tr>
    <tr>
      <th>97</th>
      <td>YASA_GEN1</td>
      <td>409</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>351.221757</td>
    </tr>
    <tr>
      <th>151</th>
      <td>YASA_GEN1</td>
      <td>456</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>26.163586</td>
      <td>113.198807</td>
    </tr>
    <tr>
      <th>205</th>
      <td>YASA_GEN1</td>
      <td>510</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>354.731626</td>
    </tr>
    <tr>
      <th>259</th>
      <td>YASA_GEN1</td>
      <td>511</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>344.201884</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>22507</th>
      <td>YASA_GEN1</td>
      <td>5122</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>27.331674</td>
      <td>82.778419</td>
    </tr>
    <tr>
      <th>22561</th>
      <td>YASA_GEN1</td>
      <td>5123</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>28.574190</td>
      <td>77.220092</td>
    </tr>
    <tr>
      <th>22615</th>
      <td>YASA_GEN1</td>
      <td>5221</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>24.763628</td>
      <td>104.622791</td>
    </tr>
    <tr>
      <th>22669</th>
      <td>YASA_GEN1</td>
      <td>5223</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>26.964860</td>
      <td>92.389966</td>
    </tr>
    <tr>
      <th>22723</th>
      <td>YASA_GEN1</td>
      <td>5331</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>34.818592</td>
      <td>73.216265</td>
    </tr>
  </tbody>
</table>
<p>421 rows × 20 columns</p>
</div>




```python
events = sorted(df_damage.typhoon_name.unique())

df_all_new = pd.DataFrame()
for typhoon in sorted(df_all.typhoon_name.unique()):
    root_typhoon = typhoon.split('_')[0]
    if typhoon != root_typhoon:
        df_reference = df_all[df_all.typhoon_name==root_typhoon].drop(['wind_speed', 'track_distance', 'typhoon_name'], axis=1)
        df_event = df_all[df_all.typhoon_name==typhoon][
            ['typhoon_name', 'grid_point_id',
            'wind_speed', 'track_distance']
            ].merge(df_reference, on='grid_point_id')
    else:
        df_event = df_all[df_all.typhoon_name == typhoon]
    df_all_new = pd.concat([df_all_new, df_event])
```


```python
df_all_new
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>typhoon_name</th>
      <th>grid_point_id</th>
      <th>total_buildings_x</th>
      <th>total_buildings_damaged</th>
      <th>perc_dmg_grid</th>
      <th>typhoon_year</th>
      <th>rainfall_max_6h</th>
      <th>rainfall_max_24h</th>
      <th>Centroid</th>
      <th>IWI</th>
      <th>total_buildings</th>
      <th>id_x</th>
      <th>with_coast</th>
      <th>coast_length</th>
      <th>mean_altitude</th>
      <th>mean_slope</th>
      <th>id_y</th>
      <th>light_index</th>
      <th>wind_speed</th>
      <th>track_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>48</th>
      <td>ANA</td>
      <td>355</td>
      <td>59.0</td>
      <td>248.0</td>
      <td>0.000638</td>
      <td>2021.0</td>
      <td>4.958333</td>
      <td>2.564583</td>
      <td>176.85E_-17.15N</td>
      <td>86.0</td>
      <td>59.0</td>
      <td>355.0</td>
      <td>1.0</td>
      <td>224.976542</td>
      <td>0.000084</td>
      <td>0.000188</td>
      <td>355.0</td>
      <td>789.968262</td>
      <td>19.720668</td>
      <td>68.119929</td>
    </tr>
    <tr>
      <th>102</th>
      <td>ANA</td>
      <td>409</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>2.450000</td>
      <td>0.933333</td>
      <td>176.95E_-12.45N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>409.0</td>
      <td>1.0</td>
      <td>9835.966285</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>409.0</td>
      <td>1721.661255</td>
      <td>0.000000</td>
      <td>404.842447</td>
    </tr>
    <tr>
      <th>156</th>
      <td>ANA</td>
      <td>456</td>
      <td>0.0</td>
      <td>248.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>5.333333</td>
      <td>2.491667</td>
      <td>176.95E_-17.15N</td>
      <td>86.0</td>
      <td>0.0</td>
      <td>456.0</td>
      <td>1.0</td>
      <td>30905.368530</td>
      <td>0.465151</td>
      <td>0.128264</td>
      <td>456.0</td>
      <td>574.940063</td>
      <td>20.567804</td>
      <td>65.531337</td>
    </tr>
    <tr>
      <th>210</th>
      <td>ANA</td>
      <td>510</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>2.941667</td>
      <td>1.037500</td>
      <td>177.05E_-12.45N</td>
      <td>71.4</td>
      <td>73.0</td>
      <td>510.0</td>
      <td>1.0</td>
      <td>19870.176731</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>510.0</td>
      <td>2067.388184</td>
      <td>0.000000</td>
      <td>409.577701</td>
    </tr>
    <tr>
      <th>264</th>
      <td>ANA</td>
      <td>511</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>2.975000</td>
      <td>1.147917</td>
      <td>177.05E_-12.55N</td>
      <td>71.4</td>
      <td>245.0</td>
      <td>511.0</td>
      <td>1.0</td>
      <td>32765.248313</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>511.0</td>
      <td>1773.442383</td>
      <td>0.000000</td>
      <td>399.527354</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>416</th>
      <td>YASA_GEN5</td>
      <td>5122</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.733333</td>
      <td>0.241667</td>
      <td>181.55E_-19.15N</td>
      <td>71.4</td>
      <td>20.0</td>
      <td>5122.0</td>
      <td>1.0</td>
      <td>49388.931854</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5122.0</td>
      <td>837.122009</td>
      <td>32.955525</td>
      <td>49.157263</td>
    </tr>
    <tr>
      <th>417</th>
      <td>YASA_GEN5</td>
      <td>5123</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.733333</td>
      <td>0.241667</td>
      <td>181.55E_-19.25N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>5123.0</td>
      <td>1.0</td>
      <td>10886.461556</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5123.0</td>
      <td>1286.776855</td>
      <td>35.381028</td>
      <td>39.023980</td>
    </tr>
    <tr>
      <th>418</th>
      <td>YASA_GEN5</td>
      <td>5221</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.066667</td>
      <td>0.039583</td>
      <td>181.65E_-18.95N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>5221.0</td>
      <td>1.0</td>
      <td>1516.399318</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5221.0</td>
      <td>578.233887</td>
      <td>27.530944</td>
      <td>73.978900</td>
    </tr>
    <tr>
      <th>419</th>
      <td>YASA_GEN5</td>
      <td>5223</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.825000</td>
      <td>0.260417</td>
      <td>181.65E_-19.15N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>5223.0</td>
      <td>1.0</td>
      <td>10173.166160</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5223.0</td>
      <td>823.425171</td>
      <td>31.760996</td>
      <td>53.712333</td>
    </tr>
    <tr>
      <th>420</th>
      <td>YASA_GEN5</td>
      <td>5331</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.491667</td>
      <td>0.131250</td>
      <td>181.75E_-19.85N</td>
      <td>71.4</td>
      <td>46.0</td>
      <td>5331.0</td>
      <td>1.0</td>
      <td>17774.293574</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5331.0</td>
      <td>1243.329590</td>
      <td>35.307982</td>
      <td>8.676828</td>
    </tr>
  </tbody>
</table>
<p>22734 rows × 20 columns</p>
</div>



## Complete df


```python
# Assume all zeros
df = df_all_new.fillna(0)
```


```python
df_complete = df.copy()
df_complete.reset_index(inplace=False)
df_complete
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>typhoon_name</th>
      <th>grid_point_id</th>
      <th>total_buildings_x</th>
      <th>total_buildings_damaged</th>
      <th>perc_dmg_grid</th>
      <th>typhoon_year</th>
      <th>rainfall_max_6h</th>
      <th>rainfall_max_24h</th>
      <th>Centroid</th>
      <th>IWI</th>
      <th>total_buildings</th>
      <th>id_x</th>
      <th>with_coast</th>
      <th>coast_length</th>
      <th>mean_altitude</th>
      <th>mean_slope</th>
      <th>id_y</th>
      <th>light_index</th>
      <th>wind_speed</th>
      <th>track_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>48</th>
      <td>ANA</td>
      <td>355</td>
      <td>59.0</td>
      <td>248.0</td>
      <td>0.000638</td>
      <td>2021.0</td>
      <td>4.958333</td>
      <td>2.564583</td>
      <td>176.85E_-17.15N</td>
      <td>86.0</td>
      <td>59.0</td>
      <td>355.0</td>
      <td>1.0</td>
      <td>224.976542</td>
      <td>0.000084</td>
      <td>0.000188</td>
      <td>355.0</td>
      <td>789.968262</td>
      <td>19.720668</td>
      <td>68.119929</td>
    </tr>
    <tr>
      <th>102</th>
      <td>ANA</td>
      <td>409</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>2.450000</td>
      <td>0.933333</td>
      <td>176.95E_-12.45N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>409.0</td>
      <td>1.0</td>
      <td>9835.966285</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>409.0</td>
      <td>1721.661255</td>
      <td>0.000000</td>
      <td>404.842447</td>
    </tr>
    <tr>
      <th>156</th>
      <td>ANA</td>
      <td>456</td>
      <td>0.0</td>
      <td>248.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>5.333333</td>
      <td>2.491667</td>
      <td>176.95E_-17.15N</td>
      <td>86.0</td>
      <td>0.0</td>
      <td>456.0</td>
      <td>1.0</td>
      <td>30905.368530</td>
      <td>0.465151</td>
      <td>0.128264</td>
      <td>456.0</td>
      <td>574.940063</td>
      <td>20.567804</td>
      <td>65.531337</td>
    </tr>
    <tr>
      <th>210</th>
      <td>ANA</td>
      <td>510</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>2.941667</td>
      <td>1.037500</td>
      <td>177.05E_-12.45N</td>
      <td>71.4</td>
      <td>73.0</td>
      <td>510.0</td>
      <td>1.0</td>
      <td>19870.176731</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>510.0</td>
      <td>2067.388184</td>
      <td>0.000000</td>
      <td>409.577701</td>
    </tr>
    <tr>
      <th>264</th>
      <td>ANA</td>
      <td>511</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2021.0</td>
      <td>2.975000</td>
      <td>1.147917</td>
      <td>177.05E_-12.55N</td>
      <td>71.4</td>
      <td>245.0</td>
      <td>511.0</td>
      <td>1.0</td>
      <td>32765.248313</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>511.0</td>
      <td>1773.442383</td>
      <td>0.000000</td>
      <td>399.527354</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>416</th>
      <td>YASA_GEN5</td>
      <td>5122</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.733333</td>
      <td>0.241667</td>
      <td>181.55E_-19.15N</td>
      <td>71.4</td>
      <td>20.0</td>
      <td>5122.0</td>
      <td>1.0</td>
      <td>49388.931854</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5122.0</td>
      <td>837.122009</td>
      <td>32.955525</td>
      <td>49.157263</td>
    </tr>
    <tr>
      <th>417</th>
      <td>YASA_GEN5</td>
      <td>5123</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.733333</td>
      <td>0.241667</td>
      <td>181.55E_-19.25N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>5123.0</td>
      <td>1.0</td>
      <td>10886.461556</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5123.0</td>
      <td>1286.776855</td>
      <td>35.381028</td>
      <td>39.023980</td>
    </tr>
    <tr>
      <th>418</th>
      <td>YASA_GEN5</td>
      <td>5221</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.066667</td>
      <td>0.039583</td>
      <td>181.65E_-18.95N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>5221.0</td>
      <td>1.0</td>
      <td>1516.399318</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5221.0</td>
      <td>578.233887</td>
      <td>27.530944</td>
      <td>73.978900</td>
    </tr>
    <tr>
      <th>419</th>
      <td>YASA_GEN5</td>
      <td>5223</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.825000</td>
      <td>0.260417</td>
      <td>181.65E_-19.15N</td>
      <td>71.4</td>
      <td>0.0</td>
      <td>5223.0</td>
      <td>1.0</td>
      <td>10173.166160</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5223.0</td>
      <td>823.425171</td>
      <td>31.760996</td>
      <td>53.712333</td>
    </tr>
    <tr>
      <th>420</th>
      <td>YASA_GEN5</td>
      <td>5331</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2020.0</td>
      <td>0.491667</td>
      <td>0.131250</td>
      <td>181.75E_-19.85N</td>
      <td>71.4</td>
      <td>46.0</td>
      <td>5331.0</td>
      <td>1.0</td>
      <td>17774.293574</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5331.0</td>
      <td>1243.329590</td>
      <td>35.307982</td>
      <td>8.676828</td>
    </tr>
  </tbody>
</table>
<p>22734 rows × 20 columns</p>
</div>




```python
# How many points do we have for each typhoon?
df_complete.groupby('typhoon_name').count()['grid_point_id']
```




    typhoon_name
    ANA             421
    ANA_GEN1        421
    ANA_GEN2        421
    ANA_GEN3        421
    ANA_GEN4        421
    ANA_GEN5        421
    EVAN            421
    EVAN_GEN1       421
    EVAN_GEN2       421
    EVAN_GEN3       421
    EVAN_GEN4       421
    EVAN_GEN5       421
    GITA            421
    GITA_GEN1       421
    GITA_GEN2       421
    GITA_GEN3       421
    GITA_GEN4       421
    GITA_GEN5       421
    HAROLD          421
    HAROLD_GEN1     421
    HAROLD_GEN2     421
    HAROLD_GEN3     421
    HAROLD_GEN4     421
    HAROLD_GEN5     421
    SARAI           421
    SARAI_GEN1      421
    SARAI_GEN2      421
    SARAI_GEN3      421
    SARAI_GEN4      421
    SARAI_GEN5      421
    TINO            421
    TINO_GEN1       421
    TINO_GEN2       421
    TINO_GEN3       421
    TINO_GEN4       421
    TINO_GEN5       421
    TOMAS           421
    TOMAS_GEN1      421
    TOMAS_GEN2      421
    TOMAS_GEN3      421
    TOMAS_GEN4      421
    TOMAS_GEN5      421
    WINSTON         421
    WINSTON_GEN1    421
    WINSTON_GEN2    421
    WINSTON_GEN3    421
    WINSTON_GEN4    421
    WINSTON_GEN5    421
    YASA            421
    YASA_GEN1       421
    YASA_GEN2       421
    YASA_GEN3       421
    YASA_GEN4       421
    YASA_GEN5       421
    Name: grid_point_id, dtype: int64




```python
# Spoiler
plt.hist(df.perc_dmg_grid)
plt.title('Distribution of housing damage at grid level')
plt.xlabel('% of buildings damaged')
plt.ylabel('Count')
plt.show()
```



![png](01.0_collate_data_files/01.0_collate_data_36_0.png)



## Create stationary dataset of Fiji


```python
df_fji = df_complete[[
            'grid_point_id',
            'IWI',
            'light_index',
            'total_buildings',
            'with_coast',
            'coast_length',
            'mean_altitude',
            'mean_slope']].drop_duplicates()
df_fji
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>grid_point_id</th>
      <th>IWI</th>
      <th>light_index</th>
      <th>total_buildings</th>
      <th>with_coast</th>
      <th>coast_length</th>
      <th>mean_altitude</th>
      <th>mean_slope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>48</th>
      <td>355</td>
      <td>86.0</td>
      <td>789.968262</td>
      <td>59.0</td>
      <td>1.0</td>
      <td>224.976542</td>
      <td>0.000084</td>
      <td>0.000188</td>
    </tr>
    <tr>
      <th>102</th>
      <td>409</td>
      <td>71.4</td>
      <td>1721.661255</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>9835.966285</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>156</th>
      <td>456</td>
      <td>86.0</td>
      <td>574.940063</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>30905.368530</td>
      <td>0.465151</td>
      <td>0.128264</td>
    </tr>
    <tr>
      <th>210</th>
      <td>510</td>
      <td>71.4</td>
      <td>2067.388184</td>
      <td>73.0</td>
      <td>1.0</td>
      <td>19870.176731</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>264</th>
      <td>511</td>
      <td>71.4</td>
      <td>1773.442383</td>
      <td>245.0</td>
      <td>1.0</td>
      <td>32765.248313</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>22512</th>
      <td>5122</td>
      <td>71.4</td>
      <td>837.122009</td>
      <td>20.0</td>
      <td>1.0</td>
      <td>49388.931854</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>22566</th>
      <td>5123</td>
      <td>71.4</td>
      <td>1286.776855</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>10886.461556</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>22620</th>
      <td>5221</td>
      <td>71.4</td>
      <td>578.233887</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1516.399318</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>22674</th>
      <td>5223</td>
      <td>71.4</td>
      <td>823.425171</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>10173.166160</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>22728</th>
      <td>5331</td>
      <td>71.4</td>
      <td>1243.329590</td>
      <td>46.0</td>
      <td>1.0</td>
      <td>17774.293574</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>421 rows × 8 columns</p>
</div>



## Write out dataset


```python
df_complete.reset_index().to_csv(
    output_dir / "new_model_training_dataset_fji_with_synthetic_ensambles.csv", index=False
)

df_fji.reset_index().to_csv(
    output_dir / "fiji_stationary_data_with_synthetic_ensambles.csv", index=False
)
```
