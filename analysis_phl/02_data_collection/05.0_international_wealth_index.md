# Mean International Wealth Index

- For Phl `https://globaldatalab.org/areadata/table/iwi/`


```python
import pandas as pd
import geopandas as gpd
from pathlib import Path
import matplotlib.pyplot as plt
import os
```


```python
base_dir = Path(os.getenv("STORM_DATA_DIR")) / "analysis_phl/02_new_model_input/"
input_dir = base_dir / "05_vulnerability/input/"
shp_input_dir = base_dir / "02_housing_damage/output/"
output_dir = base_dir / "05_vulnerability/output/"

# Load ids of municipalities
ids_mun = pd.read_csv(base_dir / "02_housing_damage/input/phl_grid_municipality_info.csv")

# Load grids
grid = gpd.read_file(base_dir / "02_housing_damage/output/phl_0.1_degree_grid_land_overlap.gpkg")

# Load IWI
iwi = pd.read_csv(input_dir / "GDL-Mean-International-Wealth-Index-(IWI)-score-of-region-data.csv")

# Load Shapefile
phl = gpd.read_file(base_dir / "02_housing_damage/input/phl_adminboundaries_candidate_adm3.zip")
phl = phl.to_crs('EPSG:4326')
```


```python
country = 'Philippines'
iwi_country = iwi[(iwi.Country == country) & (iwi.Level == 'Subnat')]
iwi_country
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Continent</th>
      <th>ISO_Code</th>
      <th>Level</th>
      <th>GDLCODE</th>
      <th>Region</th>
      <th>1992</th>
      <th>1993</th>
      <th>1994</th>
      <th>1995</th>
      <th>...</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1209</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr117</td>
      <td>ARMM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>38.1</td>
      <td>39.6</td>
      <td>41.2</td>
      <td>42.7</td>
      <td>44.3</td>
      <td>45.0</td>
      <td>45.7</td>
      <td>46.4</td>
      <td>47.1</td>
      <td>47.8</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr102</td>
      <td>Cordillera Admin Region</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>38.3</td>
      <td>...</td>
      <td>70.6</td>
      <td>70.4</td>
      <td>70.2</td>
      <td>70.1</td>
      <td>69.9</td>
      <td>69.9</td>
      <td>70.0</td>
      <td>70.1</td>
      <td>70.1</td>
      <td>70.2</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr103</td>
      <td>I-Ilocos</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>55.9</td>
      <td>...</td>
      <td>67.7</td>
      <td>68.6</td>
      <td>69.6</td>
      <td>70.6</td>
      <td>71.6</td>
      <td>71.4</td>
      <td>71.1</td>
      <td>70.9</td>
      <td>70.7</td>
      <td>70.4</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr104</td>
      <td>II-Cagayan Valley</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>63.5</td>
      <td>...</td>
      <td>63.7</td>
      <td>64.1</td>
      <td>64.5</td>
      <td>65.0</td>
      <td>65.4</td>
      <td>65.9</td>
      <td>66.4</td>
      <td>66.8</td>
      <td>67.3</td>
      <td>67.8</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr105</td>
      <td>III-Central Luzon</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>30.4</td>
      <td>...</td>
      <td>73.8</td>
      <td>74.1</td>
      <td>74.5</td>
      <td>74.9</td>
      <td>75.2</td>
      <td>74.8</td>
      <td>74.3</td>
      <td>73.8</td>
      <td>73.3</td>
      <td>72.8</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr106</td>
      <td>IVA-CALABARZON</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31.2</td>
      <td>...</td>
      <td>76.2</td>
      <td>76.2</td>
      <td>76.3</td>
      <td>76.3</td>
      <td>76.3</td>
      <td>75.5</td>
      <td>74.8</td>
      <td>74.1</td>
      <td>73.3</td>
      <td>72.6</td>
    </tr>
    <tr>
      <th>1215</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr107</td>
      <td>IVB-MIMAROPA</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>49.8</td>
      <td>...</td>
      <td>55.6</td>
      <td>57.1</td>
      <td>58.5</td>
      <td>60.0</td>
      <td>61.4</td>
      <td>61.7</td>
      <td>62.0</td>
      <td>62.3</td>
      <td>62.6</td>
      <td>62.9</td>
    </tr>
    <tr>
      <th>1216</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr112</td>
      <td>IX-Zamboanga Peninsula</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>48.3</td>
      <td>...</td>
      <td>60.8</td>
      <td>60.6</td>
      <td>60.3</td>
      <td>60.1</td>
      <td>59.9</td>
      <td>60.2</td>
      <td>60.5</td>
      <td>60.7</td>
      <td>61.0</td>
      <td>61.3</td>
    </tr>
    <tr>
      <th>1217</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr101</td>
      <td>National Capital Region</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>39.8</td>
      <td>...</td>
      <td>79.5</td>
      <td>79.9</td>
      <td>80.2</td>
      <td>80.5</td>
      <td>80.9</td>
      <td>79.2</td>
      <td>77.5</td>
      <td>75.8</td>
      <td>74.1</td>
      <td>72.4</td>
    </tr>
    <tr>
      <th>1218</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr108</td>
      <td>V-Bicol</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>38.0</td>
      <td>...</td>
      <td>59.6</td>
      <td>59.9</td>
      <td>60.1</td>
      <td>60.4</td>
      <td>60.7</td>
      <td>61.3</td>
      <td>61.9</td>
      <td>62.6</td>
      <td>63.2</td>
      <td>63.8</td>
    </tr>
    <tr>
      <th>1219</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr109</td>
      <td>VI-Western Visayas</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>40.2</td>
      <td>...</td>
      <td>60.1</td>
      <td>60.7</td>
      <td>61.3</td>
      <td>61.9</td>
      <td>62.5</td>
      <td>63.1</td>
      <td>63.7</td>
      <td>64.3</td>
      <td>64.9</td>
      <td>65.5</td>
    </tr>
    <tr>
      <th>1220</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr110</td>
      <td>VII-Central Visayas</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>38.6</td>
      <td>...</td>
      <td>64.8</td>
      <td>65.2</td>
      <td>65.6</td>
      <td>66.0</td>
      <td>66.4</td>
      <td>66.0</td>
      <td>65.5</td>
      <td>65.0</td>
      <td>64.5</td>
      <td>64.1</td>
    </tr>
    <tr>
      <th>1221</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr111</td>
      <td>VIII-Eastern Visayas</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>55.8</td>
      <td>...</td>
      <td>62.2</td>
      <td>62.4</td>
      <td>62.7</td>
      <td>63.0</td>
      <td>63.3</td>
      <td>63.4</td>
      <td>63.5</td>
      <td>63.6</td>
      <td>63.8</td>
      <td>63.9</td>
    </tr>
    <tr>
      <th>1222</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr113</td>
      <td>X-Northern Mindanao</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>84.7</td>
      <td>...</td>
      <td>62.3</td>
      <td>62.7</td>
      <td>63.0</td>
      <td>63.4</td>
      <td>63.7</td>
      <td>64.7</td>
      <td>65.6</td>
      <td>66.5</td>
      <td>67.4</td>
      <td>68.4</td>
    </tr>
    <tr>
      <th>1223</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr114</td>
      <td>XI-Davao</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>37.3</td>
      <td>...</td>
      <td>63.9</td>
      <td>62.9</td>
      <td>62.0</td>
      <td>61.0</td>
      <td>60.0</td>
      <td>61.3</td>
      <td>62.6</td>
      <td>63.9</td>
      <td>65.2</td>
      <td>66.5</td>
    </tr>
    <tr>
      <th>1224</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr115</td>
      <td>XII-SOCCSKSARGEN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>19.1</td>
      <td>...</td>
      <td>60.3</td>
      <td>60.0</td>
      <td>59.6</td>
      <td>59.2</td>
      <td>58.9</td>
      <td>59.6</td>
      <td>60.4</td>
      <td>61.2</td>
      <td>62.0</td>
      <td>62.7</td>
    </tr>
    <tr>
      <th>1225</th>
      <td>Philippines</td>
      <td>Asia/Pacific</td>
      <td>PHL</td>
      <td>Subnat</td>
      <td>PHLr116</td>
      <td>XIII-Caraga</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>49.6</td>
      <td>...</td>
      <td>62.9</td>
      <td>63.6</td>
      <td>64.4</td>
      <td>65.1</td>
      <td>65.9</td>
      <td>65.9</td>
      <td>65.9</td>
      <td>66.0</td>
      <td>66.0</td>
      <td>66.1</td>
    </tr>
  </tbody>
</table>
<p>17 rows Ã— 37 columns</p>
</div>



### Do I need to distinguish between the year?


```python
y2013 = iwi_country['2013']
y2015 = iwi_country['2015']
y2017 = iwi_country['2017']
y2019 = iwi_country['2019']
y2022 = iwi_country['2022']
fig, ax = plt.subplots(2,2)
ax = ax.flatten()

ax[0].plot(y2013,y2015, 'o')
ax[0].set_xlabel('IWI 2013')
ax[0].set_ylabel('IWI 2015')
ax[1].plot(y2015,y2017, 'o')
ax[1].set_xlabel('IWI 2015')
ax[1].set_ylabel('IWI 2017')
ax[2].plot(y2017,y2019, 'o')
ax[2].set_xlabel('IWI 2017')
ax[2].set_ylabel('IWI 2019')
ax[3].plot(y2019,y2022, 'o')
ax[3].set_xlabel('IWI 2019')
ax[3].set_ylabel('IWI 2012')

plt.tight_layout()
plt.show()
```



![png](05.0_international_wealth_index_files/05.0_international_wealth_index_6_0.png)



Nop. Its the same, they are all correlated. Lets work with the IWI 2022 since its the last one

### Municipality to grid cell

Keep in mind that I'm not distributing the IWI across each grid cell, because its a fix value for the Province. So, each grid cell of a municipality has the same value as the municipality.


```python
sorted(ids_mun.ADM1_PCODE.unique())
```




    ['PH010000000',
     'PH020000000',
     'PH030000000',
     'PH040000000',
     'PH050000000',
     'PH060000000',
     'PH070000000',
     'PH080000000',
     'PH090000000',
     'PH100000000',
     'PH110000000',
     'PH120000000',
     'PH130000000',
     'PH140000000',
     'PH150000000',
     'PH160000000',
     'PH170000000']




```python
# Create GDLCODE
ids_mun['GDLCODE'] = ids_mun['ADM1_PCODE'].apply(lambda x: 'PHLr1'+ x[2:4])

# Merge with mun
df_mun_iwi = ids_mun.merge(iwi_country[['GDLCODE', '2022']], on='GDLCODE')[['id', 'ADM1_PCODE', '2022']]

# Merge with Shapefile
IWI_phl = df_mun_iwi.merge(phl, on='ADM1_PCODE', how='left').drop_duplicates(subset=['id', '2022', 'ADM1_PCODE'])[
    ['id', '2022']
    ].reset_index(drop=True).rename({
        'id':'grid_point_id',
        '2022':'IWI'}, axis=1)
```

### Save it


```python
IWI_phl[['grid_point_id', 'IWI']].to_csv(output_dir / "phl_iwi_bygrid_new.csv", index=False)
```

### Some plots


```python
geo_IWI = gpd.GeoDataFrame(IWI_phl.merge(grid, left_on='grid_point_id', right_on='id'), geometry='geometry')
```


```python
fig, ax = plt.subplots(1, 1, figsize=(6, 6))

# Plot
geo_IWI.plot(column='IWI', cmap='viridis', linewidth=0.8, ax=ax, legend=True)

ax.set_title('ADM1 Municipality Coloring by IWI')
ax.set_xlabel('Longitude')
ax.set_ylabel('Latitude')
# Show the plot
plt.show()
```



![png](05.0_international_wealth_index_files/05.0_international_wealth_index_16_0.png)
