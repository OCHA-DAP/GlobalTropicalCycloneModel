# Mean International Wealth Index

- For Vietnam `https://globaldatalab.org/areadata/table/iwi/`


```python
import pandas as pd
import geopandas as gpd
from pathlib import Path
import matplotlib.pyplot as plt
import os
import ast
```


```python
base_dir = Path(os.getenv("STORM_DATA_DIR")) / "analysis_hti/02_model_features/"
input_dir = base_dir / "05_vulnerability/input/"
os.makedirs(input_dir, exist_ok=True)
shp_input_dir = base_dir / "02_housing_damage/output/"
output_dir = base_dir / "05_vulnerability/output/"
os.makedirs(output_dir, exist_ok=True)

# Load ids of municipalities
ids_mun = pd.read_csv(base_dir / "02_housing_damage/input/grid_municipality_info.csv")
ids_mun.ADM1_EN = ids_mun.ADM1_EN.str.upper()
# Load grids
grid = gpd.read_file(base_dir / "02_housing_damage/output/hti_0.1_degree_grid_land_overlap.gpkg")

# Load IWI
iwi = pd.read_csv(input_dir / "GDL-Mean-International-Wealth-Index-(IWI).csv")

# Load Shapefile
shp = gpd.read_file(base_dir / "02_housing_damage/input/shapefile_hti_fixed.gpkg")
shp = shp.to_crs('EPSG:4326')
```


```python
country = 'Haiti'
iwi_country = iwi[(iwi.Country == country) & (iwi.Level == 'Subnat')]
iwi_country
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Continent</th>
      <th>ISO_Code</th>
      <th>Level</th>
      <th>GDLCODE</th>
      <th>Region</th>
      <th>1992</th>
      <th>1993</th>
      <th>1994</th>
      <th>1995</th>
      <th>...</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>598</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr105</td>
      <td>Artibonite</td>
      <td>11.00</td>
      <td>11.20</td>
      <td>11.30</td>
      <td>11.50</td>
      <td>...</td>
      <td>27.5</td>
      <td>28.4</td>
      <td>29.2</td>
      <td>30.0</td>
      <td>30.9</td>
      <td>31.7</td>
      <td>32.5</td>
      <td>33.4</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>599</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr110</td>
      <td>Camps</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>30.7</td>
      <td>30.7</td>
      <td>30.7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>600</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr106</td>
      <td>Centre</td>
      <td>5.96</td>
      <td>6.79</td>
      <td>7.62</td>
      <td>8.45</td>
      <td>...</td>
      <td>21.9</td>
      <td>23.3</td>
      <td>24.8</td>
      <td>26.2</td>
      <td>27.7</td>
      <td>29.1</td>
      <td>30.6</td>
      <td>32.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>601</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr108</td>
      <td>Grande-Anse, Nippes</td>
      <td>9.21</td>
      <td>9.53</td>
      <td>9.84</td>
      <td>10.20</td>
      <td>...</td>
      <td>23.4</td>
      <td>24.2</td>
      <td>24.9</td>
      <td>25.7</td>
      <td>26.4</td>
      <td>27.2</td>
      <td>28.0</td>
      <td>28.7</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>602</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr103</td>
      <td>North</td>
      <td>12.80</td>
      <td>13.20</td>
      <td>13.70</td>
      <td>14.20</td>
      <td>...</td>
      <td>35.8</td>
      <td>36.7</td>
      <td>37.5</td>
      <td>38.4</td>
      <td>39.3</td>
      <td>40.2</td>
      <td>41.0</td>
      <td>41.9</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>603</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr104</td>
      <td>North-East</td>
      <td>11.90</td>
      <td>11.80</td>
      <td>11.70</td>
      <td>11.70</td>
      <td>...</td>
      <td>28.0</td>
      <td>30.0</td>
      <td>32.0</td>
      <td>33.9</td>
      <td>35.9</td>
      <td>37.9</td>
      <td>39.9</td>
      <td>41.9</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>604</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr109</td>
      <td>North-West</td>
      <td>13.60</td>
      <td>13.50</td>
      <td>13.40</td>
      <td>13.30</td>
      <td>...</td>
      <td>27.2</td>
      <td>28.0</td>
      <td>28.8</td>
      <td>29.6</td>
      <td>30.4</td>
      <td>31.1</td>
      <td>31.9</td>
      <td>32.7</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>605</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr107</td>
      <td>South</td>
      <td>18.80</td>
      <td>18.30</td>
      <td>17.80</td>
      <td>17.30</td>
      <td>...</td>
      <td>32.4</td>
      <td>32.1</td>
      <td>31.9</td>
      <td>31.7</td>
      <td>31.5</td>
      <td>31.2</td>
      <td>31.0</td>
      <td>30.8</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>606</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr102</td>
      <td>South-East</td>
      <td>16.70</td>
      <td>16.30</td>
      <td>16.00</td>
      <td>15.60</td>
      <td>...</td>
      <td>26.6</td>
      <td>28.0</td>
      <td>29.5</td>
      <td>30.9</td>
      <td>32.4</td>
      <td>33.8</td>
      <td>35.3</td>
      <td>36.7</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>607</th>
      <td>Haiti</td>
      <td>America</td>
      <td>HTI</td>
      <td>Subnat</td>
      <td>HTIr101</td>
      <td>West (incl Metropolitain area)</td>
      <td>40.10</td>
      <td>39.50</td>
      <td>38.90</td>
      <td>38.30</td>
      <td>...</td>
      <td>45.1</td>
      <td>46.3</td>
      <td>47.4</td>
      <td>48.5</td>
      <td>49.7</td>
      <td>50.8</td>
      <td>52.0</td>
      <td>53.1</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 37 columns</p>
</div>



### Do I need to distinguish between the year?


```python
y2013 = iwi_country['2013']
y2015 = iwi_country['2015']
y2017 = iwi_country['2017']
y2019 = iwi_country['2019']
y2020 = iwi_country['2020']
fig, ax = plt.subplots(2,2)
ax = ax.flatten()

ax[0].plot(y2013,y2015, 'o')
ax[0].set_xlabel('IWI 2013')
ax[0].set_ylabel('IWI 2015')
ax[1].plot(y2015,y2017, 'o')
ax[1].set_xlabel('IWI 2015')
ax[1].set_ylabel('IWI 2017')
ax[2].plot(y2017,y2019, 'o')
ax[2].set_xlabel('IWI 2017')
ax[2].set_ylabel('IWI 2019')
ax[3].plot(y2019,y2020, 'o')
ax[3].set_xlabel('IWI 2019')
ax[3].set_ylabel('IWI 2020')

plt.tight_layout()
plt.show()
```



![png](05.0_international_wealth_index_files/05.0_international_wealth_index_6_0.png)



Nop. Its the same, they are all correlated. Lets work with the IWI 2020 since its the last one without nans everywhere

### Municipality to grid cell

Keep in mind that I'm not distributing the IWI across each grid cell, because its a fix value for the Province. So, each grid cell of a municipality has the same value as the municipality.


```python
ids_mun.ADM1_EN.str.upper().unique()
```




    array(['ARTIBONITE', "GRANDE'ANSE", 'NORTH-WEST', 'CENTRE', 'SOUTH',
           'WEST', 'SOUTH-EAST', 'NORTH', 'NORTH-EAST', 'NIPPES'],
          dtype=object)




```python
# Fix values
iwi_country = iwi_country[['Region', '2020']].dropna()
iwi_country['Region'] = iwi_country['Region'].str.upper()

iwi_country['Region'] = iwi_country.Region.replace('GRANDE-ANSE, NIPPES', "GRANDE'ANSE")
iwi_country['Region'] = iwi_country.Region.replace('WEST (INCL METROPOLITAIN AREA)', 'WEST')
iwi_country = pd.concat([iwi_country, pd.DataFrame({'Region' : ['NIPPES'], '2020' : [28.7]})])

iwi_country = iwi_country.reset_index(drop=True)
```


```python
iwi_country
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Region</th>
      <th>2020</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ARTIBONITE</td>
      <td>33.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CENTRE</td>
      <td>32.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GRANDE'ANSE</td>
      <td>28.7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NORTH</td>
      <td>41.9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NORTH-EAST</td>
      <td>41.9</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NORTH-WEST</td>
      <td>32.7</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SOUTH</td>
      <td>30.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SOUTH-EAST</td>
      <td>36.7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>WEST</td>
      <td>53.1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NIPPES</td>
      <td>28.7</td>
    </tr>
  </tbody>
</table>
</div>




```python
# Merge with Municipality
df_mun_iwi = iwi_country.merge(ids_mun, left_on='Region', right_on='ADM1_EN').drop_duplicates(
    subset=['id', '2020', 'ADM1_EN']
    )

# Merge with Shapefile
IWI_shp = df_mun_iwi.merge(shp, on='ADM1_PCODE', how='left').drop_duplicates(subset=['id', '2020', 'ADM1_PCODE'])[
    ['id', '2020', 'geometry']
    ].reset_index(drop=True).rename({
        'id':'grid_point_id',
        '2020':'IWI'}, axis=1)
```


```python
IWI_shp
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>grid_point_id</th>
      <th>IWI</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>987</td>
      <td>33.4</td>
      <td>POLYGON ((-73.01573 19.73183, -73.01089 19.730...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1110</td>
      <td>33.4</td>
      <td>POLYGON ((-73.01573 19.73183, -73.01089 19.730...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>982</td>
      <td>33.4</td>
      <td>POLYGON ((-73.01573 19.73183, -73.01089 19.730...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>855</td>
      <td>33.4</td>
      <td>POLYGON ((-73.01573 19.73183, -73.01089 19.730...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1027</td>
      <td>33.4</td>
      <td>POLYGON ((-73.01573 19.73183, -73.01089 19.730...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>316</th>
      <td>783</td>
      <td>28.7</td>
      <td>POLYGON ((-73.44109 18.52472, -73.44059 18.524...</td>
    </tr>
    <tr>
      <th>317</th>
      <td>572</td>
      <td>28.7</td>
      <td>POLYGON ((-73.44109 18.52472, -73.44059 18.524...</td>
    </tr>
    <tr>
      <th>318</th>
      <td>614</td>
      <td>28.7</td>
      <td>POLYGON ((-73.44109 18.52472, -73.44059 18.524...</td>
    </tr>
    <tr>
      <th>319</th>
      <td>656</td>
      <td>28.7</td>
      <td>POLYGON ((-73.44109 18.52472, -73.44059 18.524...</td>
    </tr>
    <tr>
      <th>320</th>
      <td>698</td>
      <td>28.7</td>
      <td>POLYGON ((-73.44109 18.52472, -73.44059 18.524...</td>
    </tr>
  </tbody>
</table>
<p>321 rows × 3 columns</p>
</div>



### Save it


```python
IWI_shp[['grid_point_id', 'IWI']].to_csv(output_dir / "hti_iwi_bygrid_new.csv", index=False)
```

### Some plots


```python
geo_IWI = gpd.GeoDataFrame(IWI_shp[['grid_point_id', 'IWI']].merge(grid, left_on='grid_point_id', right_on='id'), geometry='geometry')
```


```python
fig, ax = plt.subplots(1, 1, figsize=(5, 5))

# Plot
geo_IWI.plot(column='IWI', cmap='viridis', linewidth=0.8, ax=ax, legend=True)

ax.set_title('ADM1 Municipality Coloring by IWI')
ax.set_xlabel('Longitude')
ax.set_ylabel('Latitude')
# Show the plot
plt.show()
```



![png](05.0_international_wealth_index_files/05.0_international_wealth_index_19_0.png)
