```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import geopandas as gpd
import os
from pathlib import Path
from climada.hazard import Centroids, TCTracks, TropCyclone
from shapely.geometry import LineString
```


```python
input_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_hti/02_model_features/02_housing_damage/input/"
)
output_dir = (
    Path(os.getenv("STORM_DATA_DIR"))
    / "analysis_hti/02_model_features/02_housing_damage/output/"
)


# Load Shapefile
shp = gpd.read_file(
    input_dir / "shapefile_hti_fixed.gpkg"
)
shp = shp.to_crs('EPSG:4326')

# Load housing damage dataset (bld)
df_housing = pd.read_csv(input_dir / "impact_data_bld_hti.csv")
```

## Some maps


```python
df_housing_new_gpd = gpd.GeoDataFrame(
    df_housing.merge(shp, on=['ADM1_PCODE', 'ADM2_PCODE'])[df_housing.columns.to_list() + ['geometry']],
    geometry='geometry')
```


```python
typhoons = df_housing_new_gpd.typhoon_name.unique()

# Select elements from typhoons list based on indices
typhoons_indices = [2, 6, 7]
selected_typhoons = [typhoons[i] for i in typhoons_indices]


df_damage = df_housing_new_gpd.copy()
fig, ax = plt.subplots(1,3, figsize=(15,5))
ax = ax.flatten()
i=0
for t in selected_typhoons:
    df_event = df_housing_new_gpd[df_housing_new_gpd.typhoon_name==t]

    # Track path
    id = df_event.sid.iloc[0]
    track = TCTracks.from_ibtracs_netcdf(storm_id=id)
    tc_track = track.get_track()

    points_ib = gpd.points_from_xy(tc_track.lon, tc_track.lat)
    tc_track_line_ib = LineString(points_ib)

    geometries_ib = gpd.GeoSeries([tc_track_line_ib])
    line_gdf_ib = gpd.GeoDataFrame(geometry=geometries_ib)

    # Plots
    df_event.plot(column='bld_affected', legend=False, ax=ax[i], cmap='Reds')
    line_gdf_ib.plot(ax=ax[i], color='k', linewidth=1, label='Typhoon track')  # Plot the LineString in black

    bld_aff = np.round(df_event.bld_affected.max())
    ax[i].set_title('{}, \n {} bld affected'.format(t.upper(), bld_aff))
    ax[i].set_xlim([-76, -70])
    ax[i].set_ylim([17, 21])
    i+=1

plt.suptitle('Building Damage, HAITI', size=20)
plt.tight_layout()
plt.show()
```

    2024-03-27 19:34:53,954 - climada.hazard.tc_tracks - WARNING - The cached IBTrACS data set dates from 2023-06-07 23:07:38 (older than 180 days). Very likely, a more recent version is available. Consider manually removing the file /Users/federico/climada/data/IBTrACS.ALL.v04r00.nc and re-running this function, which will download the most recent version of the IBTrACS data set from the official URL.
    2024-03-27 19:34:57,069 - climada.hazard.tc_tracks - WARNING - The cached IBTrACS data set dates from 2023-06-07 23:07:38 (older than 180 days). Very likely, a more recent version is available. Consider manually removing the file /Users/federico/climada/data/IBTrACS.ALL.v04r00.nc and re-running this function, which will download the most recent version of the IBTrACS data set from the official URL.
    2024-03-27 19:35:00,186 - climada.hazard.tc_tracks - WARNING - The cached IBTrACS data set dates from 2023-06-07 23:07:38 (older than 180 days). Very likely, a more recent version is available. Consider manually removing the file /Users/federico/climada/data/IBTrACS.ALL.v04r00.nc and re-running this function, which will download the most recent version of the IBTrACS data set from the official URL.




![png](00.2_damage_data_exploration_buildings_files/00.2_damage_data_exploration_buildings_4_1.png)
